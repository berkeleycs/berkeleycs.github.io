




<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    



 <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      extensions: ["tex2jax.js"],
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
      },
      "HTML-CSS": { fonts: ["TeX"] }
    });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script> 


    <!-- <link rel="stylesheet" href="/assets/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="http://cs61c.org/assets/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="http://cs61c.org/assets/open-iconic-bootstrap.min.css" crossorigin="anonymous">
    <link href='http://cs61c.org/assets/fontawesome/css/all.css' rel='stylesheet'>
    <link rel="stylesheet" href="http://cs61c.org/assets/open-sans.css" crossorigin="anonymous">
    <!-- <link rel="stylesheet" href="/assets/theme/main.css" crossorigin="anonymous" id="theme"> -->
    <link rel="stylesheet" href="http://cs61c.org/assets/theme/main.css" crossorigin="anonymous">
    <link rel="stylesheet" href="http://cs61c.org/assets/theme/main_dark.css" crossorigin="anonymous">
    <link rel="stylesheet" href="http://cs61c.org/assets/theme/switch.css" crossorigin="anonymous">
    <link rel="stylesheet" href="http://cs61c.org/assets/syntax.css" crossorigin="anonymous">
    <link rel="shortcut icon" type="image/png" href="http://cs61c.org/assets/favicon.png">
    <link href="http://cs61c.org/assets/open-iconic-bootstrap.min.css" rel="stylesheet">
    <link href="http://cs61c.org/assets/bootstrap-toc.min.css" rel="stylesheet">
    <link href="http://cs61c.org/assets/fullcalendar.min.css" rel="stylesheet">
    <link href="http://cs61c.org/assets/jquery-ui.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
    <!-- <link href="/assets/fullcalendar/packages/core/main.min.css" rel="stylesheet"> -->
    <link href="http://cs61c.org/assets/fullcalendar/packages/daygrid/main.min.css" rel="stylesheet">
    <link href="http://cs61c.org/assets/fullcalendar/packages/timegrid/main.min.css" rel="stylesheet">
    <link href="http://cs61c.org/assets/fullcalendar/packages/list/main.min.css" rel="stylesheet">
    <link href="http://cs61c.org/assets/fullcalendar/packages/bootstrap/main.min.css" rel="stylesheet">

    <title> CS 61C </title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-154217821-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-154217821-1');
    </script>
    
    <script>
    var loc = window.location.href + '';
    if (loc.indexOf('http://') == 0 && !["localhost", "127.0.0.1"].includes(window.location.hostname)){
        window.location.href = loc.replace('http://','https://');
    }
    var baseurl = "";
    </script>

  </head>
  <body>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="http://cs61c.org/assets/jquery.min.js" crossorigin="anonymous"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script> -->
    <script src="http://cs61c.org/assets/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="http://cs61c.org/assets/bootstrap-toc.min.js"></script>
    <script src="http://cs61c.org/assets/moment.min.js"></script>
    <script src="http://cs61c.org/assets/fullcalendar.min.js"></script>
    <script src="http://cs61c.org/assets/fullcalendar-gcal.js"></script>
    <script type="text/javascript" src="http://cs61c.org/assets/fullcalendar/packages/core/main.min.js"></script>
    <script type="text/javascript" src="http://cs61c.org/assets/fullcalendar/packages/daygrid/main.min.js"></script>
    <script type="text/javascript" src="http://cs61c.org/assets/fullcalendar/packages/timegrid/main.min.js"></script>
    <script type="text/javascript" src="http://cs61c.org/assets/fullcalendar/packages/list/main.min.js"></script>
    <script type="text/javascript" src="http://cs61c.org/assets/fullcalendar/packages/google_calendar/main.min.js"></script>
    <script type="text/javascript" src="http://cs61c.org/assets/fullcalendar/packages/bootstrap/main.min.js"></script>
    <!-- <script type="text/javascript" src="/assets/fullcalendar/packages/moment/main.js"></script>
    <script type="text/javascript" src="/assets/fullcalendar/packages/moment-timezone/main.js"></script> -->



    <div class="wrapper bg-white">
        <nav class="navbar bg-dark navbar-dark navbar-expand-md align-items-center">
            <div class="container">
                <a class="navbar-brand brand-berkeley" href="http://cs61c.org/fa20">
                  <img src = "http://cs61c.org/assets/icon-small.png" class="img-fluid" /> CS 61C
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon"></span>
                </button>
            
                <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
                  <ul class="navbar-nav">
                      
                      
                        


    <li class="nav-item ">
    <a class="nav-link "
         href="http://cs61c.org/fa20/calendar" >
        Calendar
        
    </a>
    </li>


                      
                        


    <li class="nav-item ">
    <a class="nav-link "
         href="http://cs61c.org/fa20/staff" >
        Staff
        
    </a>
    </li>


                      
                        


    <li class="nav-item ">
    <a class="nav-link "
         href="http://cs61c.org/fa20/policies" >
        Policies
        
    </a>
    </li>


                      
                        


    <li class="nav-item ">
    <a class="nav-link  text-muted "
         target = "_blank" href="https://piazza.com/" >
        Piazza
        
        <span class="oi oi-external-link"></span> 
        
    </a>
    </li>


                      
                        


    <li class="nav-item ">
    <a class="nav-link  text-muted "
         target = "_blank" href="https://oh.cs61c.org" >
        OH Queue
        
        <span class="oi oi-external-link"></span> 
        
    </a>
    </li>


                      
                      
                        


    <li class="nav-item ">
    <a class="nav-link  text-muted "
         target = "_blank" href="https://venus.cs61c.org/" >
        Venus
        
        <span class="oi oi-external-link"></span> 
        
    </a>
    </li>


                      
                        


    <li class="nav-item ">
    <a class="nav-link "
         href="http://cs61c.org/resources/" >
        Resources
        
    </a>
    </li>


                      
                        


    <li class="nav-item ">
    <a class="nav-link "
         href="http://cs61c.org/?redirect=false" >
        Semesters
        
    </a>
    </li>


                      

                      <li class="nav-item" align="center">
                        <label class="switch">
                        <input type="checkbox" id="themeSwitch" onload="if (returnThemeBasedOnLocalStorage() === 'dark') {this.clicked = true;}" onclick="enableTheme(this.checked === false ? 'light' : 'dark', true);">
                          <span class="slider round"></span>
                        </label>
                        <br>
                        <label for="themeSwitch" id="switch_text">Dark Mode</label>
                      </li>
                  </ul>
                </div>
            </div>
          </nav>
      
          <div class="container">
              <h1 class="mb-4">Lab 1</h1>


    <div class="row">
        <div class="col-sm-9">
            <p>Deadline: Friday, September 4</p>

<h2 id="setup">Setup</h2>
<p>To get the starter files for this lab, run the following command in your <code class="language-plaintext highlighter-rouge">labs</code>
directory.</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>git pull starter master
</code></pre></div></div>

<p>If you get an error like the following:</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fatal: <span class="s1">'starter'</span> does not appear to be a git repository
fatal: Could not <span class="nb">read </span>from remote repository.
</code></pre></div></div>
<p>make sure to set the starter remote as follows:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>git remote add starter https://github.com/61c-teach/fa20-lab-starter.git
</code></pre></div></div>
<p>and run the original command again.</p>

<h2 id="objectives">Objectives:</h2>
<ul>
  <li>TSWBAT (“<strong>T</strong>he <strong>S</strong>tudent <strong>W</strong>ill <strong>B</strong>e <strong>A</strong>ble <strong>T</strong>o”) compile and run
a C program on the EECS instructional computers and examine different types of
control flow in C</li>
  <li>TSWB (“<strong>T</strong>he <strong>S</strong>tudent <strong>W</strong>ill <strong>B</strong>e”) introduced to the C debugger and
gain practical experience using gdb to debug C programs</li>
  <li>TSWBAT work with integers, characters, boolean expressions, and bitwise
operators to simulate regular expressions in C.</li>
</ul>

<h2 id="compiling-and-running-a-c-program">Compiling and Running a C Program</h2>
<p>In this lab, we will be using the command line program gcc to compile programs
in C. The simplest way to run gcc is as follows:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>gcc program.c
</code></pre></div></div>

<p>This compiles program.c into an executable file named a.out. If you’ve taken
CS61B or have experience with Java, you can kinda think of gcc as the C equivalent
of javac. This file can be run with the following command:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>./a.out
</code></pre></div></div>

<p>The executable file is <code class="language-plaintext highlighter-rouge">a.out</code>, so what the heck is the <code class="language-plaintext highlighter-rouge">./</code> for? Answer: when
you want to execute an executable, you need to prepend a file path in order to
distinguish your command from a command like python3. The dot refers to the “current
directory.” Incidentally, double dots (<code class="language-plaintext highlighter-rouge">..</code>) would refer to the directory one
level up.</p>

<p><code class="language-plaintext highlighter-rouge">gcc</code> has various command line options which you are encouraged to
explore. In this lab, however, we will only be using <code class="language-plaintext highlighter-rouge">-o</code>, which is used to specify
the name of the executable file that <code class="language-plaintext highlighter-rouge">gcc</code> creates. You can use the following
commands to compile <code class="language-plaintext highlighter-rouge">program.c</code> into a program named program, and then run it.
This is helpful if you don’t want all of your executable files to be named <code class="language-plaintext highlighter-rouge">a.out</code>.</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>gcc <span class="nt">-o</span> program program.c
<span class="gp">$</span><span class="w"> </span>./program
</code></pre></div></div>

<h3 id="optional-c-compiler-local-installation">Optional: C Compiler local installation</h3>
<h4 id="mac">Mac</h4>
<p>Install the Xcode command line tool by running</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>xcode-select <span class="nt">--install</span>
</code></pre></div></div>
<p>Then, you can check whether gcc is successfully installed by running</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gcc <span class="nt">--version</span>
</code></pre></div></div>

<h4 id="ubuntudebian">Ubuntu/Debian</h4>
<p>Install the <code class="language-plaintext highlighter-rouge">build-essential</code> package by running</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>apt <span class="nb">install </span>build-essential cgdb valgrind
</code></pre></div></div>
<p>This installs many packages such as <code class="language-plaintext highlighter-rouge">gcc</code> and <code class="language-plaintext highlighter-rouge">make</code>, as well as the <code class="language-plaintext highlighter-rouge">cgdb</code> and <code class="language-plaintext highlighter-rouge">valgrind</code> debuging tools. If you’re curious, <a href="https://packages.ubuntu.com/xenial/build-essential">here</a> is a detailed description of the <code class="language-plaintext highlighter-rouge">build-essential</code> package as of Ubuntu 18.04.</p>

<h4 id="windows">Windows</h4>
<p>For Windows users, if you don’t want to use the Hive and want to develop locally, we suggest that you use Windows Subsystem for Linux. If you haven’t already, follow the instructions in the <a href="https://piazza.com/class/kd0ifacummd56a?cid=10">Setup for Windows Users</a> post on Piazza. Part of these instructions include installing a C compiler in your WSL subsystem.</p>

<h2 id="exercise-1-see-what-you-can-c">Exercise 1: See what you can C</h2>
<p>In this exercise, we will see an example of preprocessor macro definitions. Macros
can be a messy topic, but in general the way they work is that before a C file is
compiled, all <code class="language-plaintext highlighter-rouge">define</code> macro constant names are replaced exactly with the value
they refer to. In the scope of this exercise, we will be using macro definitions
exclusively as global constants. Here we define <code class="language-plaintext highlighter-rouge">CONSTANT_NAME</code> to refer to
<code class="language-plaintext highlighter-rouge">literal_value</code> (an integer literal). Note that there is only a space separating
name from value.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#define CONSTANT_NAME literal_value
</span></code></pre></div></div>

<p>Now, look at the code contained in <code class="language-plaintext highlighter-rouge">eccentric.c</code>. <strong>Notice</strong> the four different
examples of basic C control flow. (Think: What are they?) Also, do you recognize
these eccentric sayings and people from Berkeley? :)</p>

<p>First compile and run the program to see what it does. Play around with the
constant values of the four macros: V0 through V3. See how changing <strong>each</strong> of
them changes the program output.</p>

<h3 id="action-item">Action Item</h3>
<p>Modifying only these four values, make the program produce the following output.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Berkeley eccentrics:
====================
Happy Happy Happy
Yoshua
Go BEARS!
</code></pre></div></div>

<p>There are actually several different combinations of macros that can give this
output. Here’s the challenge for you in this exercise: <strong>consider what the minimum
number of <em>distinct</em> values that V0 through V3 can have such that they still give
this exact output. For example, the theoretical maximum is four, when they are all
distinct from each other.</strong></p>

<p>Stuck on how to run the program? Revisit the introduction. We’d like you to compile
the program into an executable called <code class="language-plaintext highlighter-rouge">eccentric</code>; can you use the <code class="language-plaintext highlighter-rouge">-o</code> flag to
do this?</p>

<h2 id="exercise-2-catch-those-bugs">Exercise 2: Catch those bugs!</h2>
<p>A <strong>debugger</strong>, as the name suggests, is a program which is designed specifically
to help you find bugs, or logical errors and mistakes in your code (side note:
if you want to know why errors are called bugs, look <a href="https://www.quora.com/Why-are-errors-in-software-codes-called-bugs">here</a>).
Different debuggers have different features, but it is common for all debuggers
to be able to do the following things:</p>

<ol>
  <li>Set a breakpoint in your program. A breakpoint is a specific line in your code
where you would like to stop execution of the program so you can take a look at
what’s going on nearby.</li>
  <li>Step line-by-line through the program. Code only ever executes line by line,
but it happens too quickly for us to figure out which lines cause mistakes. Being
able to step line-by-line through your code allows you to hone in on exactly what
is causing a bug in your program.</li>
</ol>

<p>For this exercise, you will find the <a href="../../../resources/pdf%3Ffile=gdb5-refcard.pdf.html">GDB reference card useful</a>.
GDB stands for “GNU De-Bugger.” Compile <code class="language-plaintext highlighter-rouge">hello.c</code> with the <code class="language-plaintext highlighter-rouge">-g</code> flag:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gcc <span class="nt">-g</span> <span class="nt">-o</span> hello hello.c
</code></pre></div></div>

<p>This causes gcc to store information in the executable program for <code class="language-plaintext highlighter-rouge">gdb</code> to make
sense of it. Now start our debugger, (c)gdb:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cgdb hello
</code></pre></div></div>

<p>Notice what this command does! You are running the program cgdb on the executable
file hello generated by gcc. Don’t try running cgdb on the source code in hello.c!
It won’t know what to do. If cgdb does not work, you can also use gdb to complete
the following exercises (start gdb with <code class="language-plaintext highlighter-rouge">gdb hello</code>). The cgdb debugger is only
installed on your cs61c-xxx accounts. Please use the hive machines or one of the
computers in 27x Soda to run cgdb, since our version of cgdb was built for Ubuntu.</p>

<p>Note: you’re welcome to install and run (c)gdb on your local computer, but be
advised it may not install on (updated) macOS machines. If this applies to you,
you can use lldb which is another great debugger. The commands differ slightly,
but there are great guides out there (<a href="https://lldb.llvm.org/lldb-gdb.html">like this one!</a>)
to help you get started. For this lab, though, use the lab machines and cgdb.</p>

<h3 id="action-item-1">Action Item</h3>
<p>Step through the whole program by doing the following:</p>
<ol>
  <li>setting a breakpoint at main</li>
  <li>using gdb’s run command</li>
  <li>using gdb’s single-step command</li>
</ol>

<p>Type help from within gdb to find out the commands to do these things, or use the
reference card.</p>

<p><strong>Look here if you see an error message like printf.c: No such file or directory.</strong>
You probably stepped into a printf function! If you keep stepping, you’ll feel
like you’re going nowhere! CGDB is complaining because you don’t have the actual
file where printf is defined. This is pretty annoying. To free yourself from this
black hole, use the command finish to run the program until the current frame
returns (in this case, until printf is finished). And <strong>NEXT</strong> time, use next to
skip over the line which used printf.</p>

<h3 id="note-cgdb-vs-gdb">Note: cgdb vs gdb</h3>
<p>In this exercise, we use cgdb to debug our programs. cgdb is identical to gdb,
except it provides some extra nice features that make it more pleasant to use in
practice. All of the commands on the reference sheet work in gdb.</p>

<p>In cgdb, you can press <code class="language-plaintext highlighter-rouge">ESC</code> to go to the code window (top) and <code class="language-plaintext highlighter-rouge">i</code> to return to
the command window (bottom) — similar to vim. The bottom command window is where
you’ll enter your gdb commands.</p>

<h3 id="action-item-2">Action Item</h3>
<p>Learning these commands will prove useful for the rest of this lab, and your C
programming career in general. In the text file named <code class="language-plaintext highlighter-rouge">gdb.txt</code>, answer the
following questions.</p>
<ol>
  <li>While you’re in a gdb session, how do you <strong>set the arguments</strong> that will be
passed to the program when it’s run?</li>
  <li>How do you <strong>create a breakpoint</strong>?</li>
  <li>How do you <strong>execute the next line of C code</strong> in the program after stopping
at a breakpoint?</li>
  <li>If the next line of code is a function call, you’ll execute the whole function
call at once if you use your answer to #3. (If not, consider a different command
for #3!) How do you tell GDB that you <strong>want to debug the code inside the function</strong>
(i.e. step into the function) instead? (If you changed your answer to #3, then
that answer is most likely now applicable here.)</li>
  <li>How do you <strong>continue the program after stopping</strong> at a breakpoint?</li>
  <li>How can you <strong>print the value of a variable</strong> (or even an expression like 1+2)
in gdb?</li>
  <li>How do you configure gdb so it <strong>displays the value of a variable after every step</strong>?</li>
  <li>How do you <strong>show a list of all variables and their values</strong> in the current
function?</li>
  <li>How do you <strong>quit</strong> out of gdb?</li>
</ol>

<h2 id="exercise-3-debugging-w-youser-input">Exercise 3: Debugging w/ YOU(ser input)</h2>
<p>Let’s see what happens if your program requires user input and you try to run GDB
on it. First, run the program defined by <code class="language-plaintext highlighter-rouge">interactive_hello.c</code> to talk to an overly
friendly program.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gcc <span class="nt">-g</span> <span class="nt">-o</span> int_hello interactive_hello.c
<span class="nv">$ </span>./int_hello
</code></pre></div></div>

<p>Now, we’re going to try to debug it (even though there really are no bugs).</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>cgdb int_hello
</code></pre></div></div>

<p>What happens when you try to run the program to completion?
We’ll be learning about a tool to help us avoid this situation. The purpose of this
exercise is to make you <strong>unafraid</strong> of running the debugger even when your program
needs user input. It turns out that you can send text to <a href="https://en.wikipedia.org/wiki/Standard_streams#Standard_input_.28stdin.29"><code class="language-plaintext highlighter-rouge">stdin</code></a>,
the file stream read by the function fgets in this silly program, with some
special characters right from the command line.</p>

<p>Take a look at “redirection” on <a href="https://www.cs.bu.edu/teaching/c/file-io/intro/">this website</a>,
and see if you can figure out how to send some input to the program without
explicitly providing it while it’s running (which, you might have realized, gets
you stuck in CGDB).
Look at <a href="https://stackoverflow.com/questions/19467865/how-to-use-redirection-in-c-for-file-input">this stackoverflow post</a>
for more inspiration.</p>

<p>Hint 1: If you’re creating a text file containing your input, you’re on the right track!
Hint 2: Remember you can run things with <strong>command line args (including the
redirection symbols) from CGDB as well!</strong></p>

<p>Hopefully you’ll appreciate how redirection helps you avoid that nasty situation
with CGDB. Don’t ever be afraid of the debugger! We know it looks kind of nasty,
but it’s there to help you.</p>

<h2 id="exercise-4-valgrinding-away">Exercise 4: Valgrind’ing away</h2>
<p>Even with a debugger, we might not be able to catch all bugs. Some bugs are what
we refer to as “bohrbugs”, meaning they manifest reliably under a well-defined,
but possibly unknown, set of conditions. Other bugs are what we call “heisenbugs”,
and instead of being determinant, they’re known to disappear or alter their behavior
when one attempts to study them. <strong>We can detect the first kind with debuggers,
but the second kind may slip under our radar because they’re (at least in C) often
due to mis-managed memory.</strong></p>

<p>Remember that unlike other programming languages, C requires you (the programmer)
to manually manage your memory. We’ll cover this more later this week, but this is
all you’ll need to know for now.</p>

<p>To help catch these “heisenbugs” we will use a tool called Valgrind. Valgrind is
a program which emulates your CPU and tracks your memory accesses. This slows
down the process you’re running (which is why we don’t, for example, always run all
executables inside Valgrind) but also can expose bugs that may only display visible
incorrect behavior under a unique set of circumstances.</p>

<p>Note: Valgrind is available available for install on most Unix-like distros
as well as macOS, though many students have reported compatibility issues between
Valgrind and recent versions of macOS. If you cannot get a local install to work,
we recommend that you use the Hive machines for C development; these tools will
become incredibly helpful as you work on more C assignments (Project 1 &amp; 4!).</p>

<p>In this exercise we are going demonstrate two different examples of Valgrind outputs
and walk through how each might be useful.</p>

<p>First try building two new executables, <code class="language-plaintext highlighter-rouge">segfault_ex</code> from <code class="language-plaintext highlighter-rouge">segfault_ex.c</code> and
<code class="language-plaintext highlighter-rouge">no_segfault_ex</code> from <code class="language-plaintext highlighter-rouge">no_segfault_ex.c</code> (use the <code class="language-plaintext highlighter-rouge">-o</code> flag from before!). At
this point you should be able to use <code class="language-plaintext highlighter-rouge">gcc</code> to successfully build these executables.</p>

<p>Now let’s try running the executables. What outputs do you observe?</p>

<p>Let’s start with <code class="language-plaintext highlighter-rouge">segfault_ex</code>. You should have observed a segmentation fault
(segfault), which occurs when a program crashes from trying to access memory that
is not available to it (more on this later in the course; This is actually an
artifact from early memory design. Today we work with ‘paged memory’ instead of
‘segmented memory’ but the error message remains!).</p>

<p>This C file is very small so you should be able to open the file and understand
what is causing the segfault. Do so at this time, but do not change the file. Why
does the segfault occur?</p>

<p>Now let’s understand what to do if we have a very large file and need to find a
segfault. Here is where Valgrind is our new friend. To run the program in Valgrind
use the command:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span><span class="w"> </span>valgrind ./segfault_ex
</code></pre></div></div>
<p>This should cause Valgrind to output where the illegal access occurred. Compare
these results to what you determined by opening the file. How could Valgrind help
you address a segfault in the future?
Now try running Valgrind on <code class="language-plaintext highlighter-rouge">no_segfault_ex</code>. The program should not have
crashed but there is still an issue with the file. Valgrind can help us find the
(seemingly invisible) problem.</p>

<p>Unfortunately here you will see that Valgrind seems to not be able to tell you
exactly where the problem is occurring. Use the message provided by Valgrind to
<strong>determine which variable has undefined behavior and then try to infer what must
have happened</strong> (Hint: What is an uninitialized value?).</p>

<p>At this point we do not expect you to be familiar with <code class="language-plaintext highlighter-rouge">sizeof</code> (that comes next
week!) so all we want you to get out of this section is some intuition around
where the problem likely occurred.</p>

<p>Hopefully after walking through this example you’ll be able to understand and
answer the following:</p>
<ul>
  <li>Why is Valgrind important and how is it useful?</li>
  <li>How do you run a program in Valgrind?</li>
  <li>How do you interpret the error messages? <strong>Don’t be afraid of them. Try your
best and ask us for help.</strong></li>
  <li>Why might uninitialized variables result in “heisenbugs”?</li>
</ul>

<p>We are introducing you to Valgrind now because it is an extremely important tool
that you will want as soon as you start writing C. <strong>However to really appreciate
it we will need to learn about C’s memory model, which we will do next week.</strong>
After you have covered memory in lecture, come back to this lab and try answering
the following questions:</p>
<ul>
  <li>Why <strong>didn’t</strong> the <code class="language-plaintext highlighter-rouge">no_segfault_ex</code> program segfault?</li>
  <li>Why does the <code class="language-plaintext highlighter-rouge">no_segfault_ex</code> produce inconsistent outputs?</li>
  <li>Why is <code class="language-plaintext highlighter-rouge">sizeof</code> incorrect? How could you still use <code class="language-plaintext highlighter-rouge">sizeof</code> but make the code
correct?</li>
</ul>

<h2 id="exercise-5-pointers-and-structures-in-c">Exercise 5: Pointers and Structures in C</h2>
<p>Here’s one to help you in your interviews. In <code class="language-plaintext highlighter-rouge">ll_cycle.c</code>, complete the function
<code class="language-plaintext highlighter-rouge">ll_has_cycle()</code> to implement the following algorithm for checking if a singly-
linked list has a cycle.</p>

<ol>
  <li>Start with two pointers at the head of the list. We’ll call the first one
tortoise and the second one hare.</li>
  <li>Advance hare by two nodes. If this is not possible because of a null pointer,
we have found the end of the list, and therefore the list is acyclic.</li>
  <li>Advance tortoise by one node. (A null pointer check is unnecessary. Why?)</li>
  <li>If tortoise and hare point to the same node, the list is cyclic. Otherwise,
go back to step 2.</li>
</ol>

<p>If you want to see the definition of the <code class="language-plaintext highlighter-rouge">node</code> struct, open the <code class="language-plaintext highlighter-rouge">ll_cycle.h</code>
header file.</p>

<h3 id="action-item-3">Action Item</h3>
<p>Implement <code class="language-plaintext highlighter-rouge">ll_has_cycle()</code>. Once you’ve done so, you can execute the following
commands to run the tests for your code. If you make <strong>any</strong> changes, make sure
to run <strong>ALL</strong> of the following commands again, in order.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gcc <span class="nt">-g</span> <span class="nt">-o</span> test_ll_cycle test_ll_cycle.c ll_cycle.c
<span class="nv">$ </span>./test_ll_cycle
</code></pre></div></div>

<p>Hint: There are two common ways that students usually write this function. They
differ in how they choose to encode the stopping criteria. If you do it one way,
you’ll have to account for a special case in the beginning. If you do it another
way, you’ll have some extra NULL checks, which is OK. The previous 2 sentences
are meant to urge you to not stress over cleanliness. If they don’t help you,
just ignore them. The point of this exercise is to make sure you know how to use
pointers.</p>

<p>Here’s a <a href="https://en.wikipedia.org/wiki/Cycle_detection#Floyd.27s_Tortoise_and_Hare">Wikipedia article</a>
on the algorithm and why it works. Don’t worry about it if you don’t completely
understand it. We won’t test you on this.</p>

<p>By the way, the pointers are called “tortoise” and “hare” because the tortoise
pointer is incremented slowly (like a tortoise, which moves slowly) and the hare
pointer is incremented quickly (twice as fast as the tortoise; like a hare, which
moves quickly).</p>

<p>As a closing note, the story of <a href="http://read.gov/aesop/025.html">the tortoise and the hare</a>
is always relevant, especially in CS61C. Writing your C programs slowly and steadily,
using debugging programs like CGDB, is what will win you the race.</p>

<h2 id="checkoff">Checkoff</h2>
<p>Please submit to the <strong>Lab Autograder</strong> assignment (same as last week!).</p>

<p>Note that the autograder for the gdb answers is very simple. Make sure that:</p>
<ol>
  <li>All of the lines in the <code class="language-plaintext highlighter-rouge">gdb.txt</code> file start with the answer number (e.g.
<code class="language-plaintext highlighter-rouge">1. answer</code>).</li>
  <li>Only put the command <strong>name</strong> in the answers. So, if we have a command that
takes an argument, i.e. <code class="language-plaintext highlighter-rouge">command arg</code>, only put <code class="language-plaintext highlighter-rouge">command</code> in the <code class="language-plaintext highlighter-rouge">gdb.txt</code> file.</li>
</ol>

<p>For checkoff, make sure you’re prepared to answer questions about what you did. It
may help to briefly review what you changed/wrote right before checkoff.</p>

        </div>
        <div class="col-sm-3">
            <nav id="toc" class="sticky-top" style="top: 40px;"></nav>
        </div>
    </div>
    
    <script>
        $(function() {
            var navSelector = "#toc";
            var $myNav = $(navSelector);
            Toc.init($myNav);
            $("body").scrollspy({
                target: navSelector
            });
        });
    </script>


          </div>
    </div>

    <footer class="page-footer">
        <ul class="nav justify-content-center">
            <li class="nav-item">
                <a class="nav-link text-secondary" href="http://cs61c.org/fa20">
                  CS 61C
                </a>
              </li>
            
            
              

<li class="nav-item">
    <a class="nav-link "  href="http://cs61c.org/fa20/calendar" >
      Calendar
    </a>
  </li>

            
              

<li class="nav-item">
    <a class="nav-link "  href="http://cs61c.org/fa20/staff" >
      Staff
    </a>
  </li>

            
              

<li class="nav-item">
    <a class="nav-link "  href="http://cs61c.org/fa20/policies" >
      Policies
    </a>
  </li>

            
              

<li class="nav-item">
    <a class="nav-link  text-dark "  href="https://piazza.com/" >
      Piazza
    </a>
  </li>

            
              

<li class="nav-item">
    <a class="nav-link  text-dark "  href="https://oh.cs61c.org" >
      OH Queue
    </a>
  </li>

            
            
              

<li class="nav-item">
    <a class="nav-link  text-dark "  href="https://venus.cs61c.org/" >
      Venus
    </a>
  </li>

            
              

<li class="nav-item">
    <a class="nav-link "  href="http://cs61c.org/resources/" >
      Resources
    </a>
  </li>

            
              

<li class="nav-item">
    <a class="nav-link "  href="http://cs61c.org/?redirect=false" >
      Semesters
    </a>
  </li>

            

            <li class="nav-item">
              <a class="nav-link text-secondary" href="index.html#">
                Back to top
              </a>
            </li>
        </ul>
    </footer>

    <script type="text/javascript" src="http://cs61c.org/assets/theme/theme.js"></script>
  </body>
</html>
