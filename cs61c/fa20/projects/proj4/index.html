




<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    



 <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      extensions: ["tex2jax.js"],
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
      },
      "HTML-CSS": { fonts: ["TeX"] }
    });
  </script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script> 


    <!-- <link rel="stylesheet" href="/assets/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous"> -->
    <link rel="stylesheet" href="http://cs61c.org/assets/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="http://cs61c.org/assets/open-iconic-bootstrap.min.css" crossorigin="anonymous">
    <link href='http://cs61c.org/assets/fontawesome/css/all.css' rel='stylesheet'>
    <link rel="stylesheet" href="http://cs61c.org/assets/open-sans.css" crossorigin="anonymous">
    <!-- <link rel="stylesheet" href="/assets/theme/main.css" crossorigin="anonymous" id="theme"> -->
    <link rel="stylesheet" href="http://cs61c.org/assets/theme/main.css" crossorigin="anonymous">
    <link rel="stylesheet" href="http://cs61c.org/assets/theme/main_dark.css" crossorigin="anonymous">
    <link rel="stylesheet" href="http://cs61c.org/assets/theme/switch.css" crossorigin="anonymous">
    <link rel="stylesheet" href="http://cs61c.org/assets/syntax.css" crossorigin="anonymous">
    <link rel="shortcut icon" type="image/png" href="http://cs61c.org/assets/favicon.png">
    <link href="http://cs61c.org/assets/open-iconic-bootstrap.min.css" rel="stylesheet">
    <link href="http://cs61c.org/assets/bootstrap-toc.min.css" rel="stylesheet">
    <link href="http://cs61c.org/assets/fullcalendar.min.css" rel="stylesheet">
    <link href="http://cs61c.org/assets/jquery-ui.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet">
    <!-- <link href="/assets/fullcalendar/packages/core/main.min.css" rel="stylesheet"> -->
    <link href="http://cs61c.org/assets/fullcalendar/packages/daygrid/main.min.css" rel="stylesheet">
    <link href="http://cs61c.org/assets/fullcalendar/packages/timegrid/main.min.css" rel="stylesheet">
    <link href="http://cs61c.org/assets/fullcalendar/packages/list/main.min.css" rel="stylesheet">
    <link href="http://cs61c.org/assets/fullcalendar/packages/bootstrap/main.min.css" rel="stylesheet">

    <title> CS 61C </title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-154217821-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-154217821-1');
    </script>
    
    <script>
    var loc = window.location.href + '';
    if (loc.indexOf('http://') == 0 && !["localhost", "127.0.0.1"].includes(window.location.hostname)){
        window.location.href = loc.replace('http://','https://');
    }
    var baseurl = "";
    </script>

  </head>
  <body>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="http://cs61c.org/assets/jquery.min.js" crossorigin="anonymous"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script> -->
    <script src="http://cs61c.org/assets/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="http://cs61c.org/assets/bootstrap-toc.min.js"></script>
    <script src="http://cs61c.org/assets/moment.min.js"></script>
    <script src="http://cs61c.org/assets/fullcalendar.min.js"></script>
    <script src="http://cs61c.org/assets/fullcalendar-gcal.js"></script>
    <script type="text/javascript" src="http://cs61c.org/assets/fullcalendar/packages/core/main.min.js"></script>
    <script type="text/javascript" src="http://cs61c.org/assets/fullcalendar/packages/daygrid/main.min.js"></script>
    <script type="text/javascript" src="http://cs61c.org/assets/fullcalendar/packages/timegrid/main.min.js"></script>
    <script type="text/javascript" src="http://cs61c.org/assets/fullcalendar/packages/list/main.min.js"></script>
    <script type="text/javascript" src="http://cs61c.org/assets/fullcalendar/packages/google_calendar/main.min.js"></script>
    <script type="text/javascript" src="http://cs61c.org/assets/fullcalendar/packages/bootstrap/main.min.js"></script>
    <!-- <script type="text/javascript" src="/assets/fullcalendar/packages/moment/main.js"></script>
    <script type="text/javascript" src="/assets/fullcalendar/packages/moment-timezone/main.js"></script> -->



    <div class="wrapper bg-white">
        <nav class="navbar bg-dark navbar-dark navbar-expand-md align-items-center">
            <div class="container">
                <a class="navbar-brand brand-berkeley" href="http://cs61c.org/fa20">
                  <img src = "http://cs61c.org/assets/icon-small.png" class="img-fluid" /> CS 61C
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon"></span>
                </button>
            
                <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
                  <ul class="navbar-nav">
                      
                      
                        


    <li class="nav-item ">
    <a class="nav-link "
         href="http://cs61c.org/fa20/calendar" >
        Calendar
        
    </a>
    </li>


                      
                        


    <li class="nav-item ">
    <a class="nav-link "
         href="http://cs61c.org/fa20/staff" >
        Staff
        
    </a>
    </li>


                      
                        


    <li class="nav-item ">
    <a class="nav-link "
         href="http://cs61c.org/fa20/policies" >
        Policies
        
    </a>
    </li>


                      
                        


    <li class="nav-item ">
    <a class="nav-link  text-muted "
         target = "_blank" href="https://piazza.com/" >
        Piazza
        
        <span class="oi oi-external-link"></span> 
        
    </a>
    </li>


                      
                        


    <li class="nav-item ">
    <a class="nav-link  text-muted "
         target = "_blank" href="https://oh.cs61c.org" >
        OH Queue
        
        <span class="oi oi-external-link"></span> 
        
    </a>
    </li>


                      
                      
                        


    <li class="nav-item ">
    <a class="nav-link  text-muted "
         target = "_blank" href="https://venus.cs61c.org/" >
        Venus
        
        <span class="oi oi-external-link"></span> 
        
    </a>
    </li>


                      
                        


    <li class="nav-item ">
    <a class="nav-link "
         href="http://cs61c.org/resources/" >
        Resources
        
    </a>
    </li>


                      
                        


    <li class="nav-item ">
    <a class="nav-link "
         href="http://cs61c.org/?redirect=false" >
        Semesters
        
    </a>
    </li>


                      

                      <li class="nav-item" align="center">
                        <label class="switch">
                        <input type="checkbox" id="themeSwitch" onload="if (returnThemeBasedOnLocalStorage() === 'dark') {this.clicked = true;}" onclick="enableTheme(this.checked === false ? 'light' : 'dark', true);">
                          <span class="slider round"></span>
                        </label>
                        <br>
                        <label for="themeSwitch" id="switch_text">Dark Mode</label>
                      </li>
                  </ul>
                </div>
            </div>
          </nav>
      
          <div class="container">
              <h1 class="mb-4">Project 4&#58; Numc</h1>


    <div class="row">
        <div class="col-sm-9">
            <style>
table {
    color: #333; /* Lighten up font color */
    font-family: Helvetica, Arial, sans-serif; /* Nicer font */
    border-collapse:
    collapse; border-spacing: 0;
    padding: 10px;
    align:center;
}

td, th { border: 1px solid #CCC; height: 30px; } /* Make cells a bit taller */

th {
    background: #F3F3F3; /* Light grey background */
    font-weight: bold; /* Make sure they're bold */
    padding: 10px;
}

td {
    background: #FAFAFA; /* Lighter grey background */
    text-align: center; /* Center our text */
    padding: 10px;
}

.grading-graphs td {
    width: 50%;
}

.container .row img {
  max-width: 100%;
}
</style>

<h2 id="overview">Overview</h2>

<p><strong>Due Wednesday, December 4th</strong></p>

<p>This project is designed to be both a C project as well as a performance project. In this project you will be implementing a slower version of numpy. Your version of numpy, <code class="language-plaintext highlighter-rouge">numc</code> (how exciting!), is most likely to be slower than numpy, but much faster than the naive implementations of matrix operations. You will first complete a naive solution for some matrix functions in C, then you will experiment with the setup file in Python to install your <code class="language-plaintext highlighter-rouge">numc</code> module. After that, you will gain a deeper understanding of the Python-C interface by overloading some operators and defining some instance methods for <code class="language-plaintext highlighter-rouge">numc.Matrix</code> objects. Finally, you will speed up your naive solution, thus making <code class="language-plaintext highlighter-rouge">numc.Matrix</code> operations faster.</p>

<p>Do not expect your final completed <code class="language-plaintext highlighter-rouge">numc</code> module to be as good as numpy, but you should expect a very large speedup compared to the naive solution, especially for matrix multiplication and exponentiation!</p>

<h2 id="tips-and-guidelines">Tips and Guidelines</h2>
<div id="tip"></div>

<p><strong><a href="https://piazza.com/class/kd0ifacummd56a?cid=3778">Here</a> is a list of all the important clarifications!!</strong> For each new clarification we make, it will be reflected both in that post and the spec.</p>

<ul>
  <li><strong>Please start early!</strong> Because there are many more 61C students than Hive machines, you will likely share resources with your classmates. This might affect the measurement of your code’s speedup. We encourage you to use <a href="https://hivemind.eecs.berkeley.edu/">Hivemind</a> to help balance the load amongst the hive machines.
    <ul>
      <li>You will have 6 tokens every 24 hours for the Gradescope assignment.</li>
      <li>You can complete task 1 through 3 before the performance lectures (lec 33-35) and task 4 after. So again, please start early!</li>
    </ul>
  </li>
  <li>You will get negative points up to the number of points it is worth if you fail to complete task 5, so you should do it as much as you can even if you do not complete the entire project!</li>
  <li>You can either allocate new matrices and throw errors in <strong><code class="language-plaintext highlighter-rouge">numc.c</code></strong> or <strong><code class="language-plaintext highlighter-rouge">matrix.c</code></strong>.</li>
  <li>We will not be directly testing your C code. All tests will be in Python!</li>
  <li>You may change the function signatures in <strong><code class="language-plaintext highlighter-rouge">matrix.h</code></strong> and <strong><code class="language-plaintext highlighter-rouge">matrix.c</code></strong> as you deem appropriate, but you may not change the function signatures in <strong><code class="language-plaintext highlighter-rouge">numc.h</code></strong> and <strong><code class="language-plaintext highlighter-rouge">numc.c</code></strong>.</li>
  <li>You may change the skeleton code in <strong><code class="language-plaintext highlighter-rouge">numc.c</code></strong>.</li>
  <li>You may <strong>NOT</strong> add/remove any additional imports.</li>
  <li>If you would like to run the reference solution to compare your solution to, you can import the <strong><code class="language-plaintext highlighter-rouge">dumbpy</code></strong> library on hive as we have already installed it there for you!</li>
  <li>For this project, <strong>we strongly suggest working on Hive machines under you cs61c account</strong>. We have set up a few environment settings that only work if you use your cs61c account.</li>
</ul>

<h2 id="getting-started">Getting Started</h2>
<p>Ssh into one of the hive machines <strong>under your cs61c class account</strong>.</p>

<p>Please follow the directions in this Google Form to get a repository: <a href="https://docs.google.com/forms/d/e/1FAIpQLSc59h0HsJLPfhqbJ8hil01lrfIvK0xTPxTihB1C3KfpmkGc2Q/viewform">https://docs.google.com/forms/d/e/1FAIpQLSc59h0HsJLPfhqbJ8hil01lrfIvK0xTPxTihB1C3KfpmkGc2Q/viewform</a>. After completing the form, clone your GitHub Classroom repository and add the starter code repository as a remote:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone YOUR_REPO_NAME
<span class="nv">$ </span><span class="nb">cd </span>YOUR_REPO_NAME
<span class="nv">$ </span>git remote add starter https://github.com/61c-teach/fa20-proj4-starter.git
</code></pre></div></div>
<p>If we publish changes to the starter code, retrieve them using git pull starter master.</p>

<p>To be able install the modules that you will complete in this project, you must create a virtual environment with by running</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python3.6 <span class="nt">-m</span> venv .venv
</code></pre></div></div>
<p>Note that you <strong>MUST</strong> use python 3.6 as our reference module <code class="language-plaintext highlighter-rouge">dumbpy</code> only supports this specific version of python.
Finally, run the following command to activate the virtual environment:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">source</span> .venv/bin/activate
</code></pre></div></div>
<p>This will put you in a virtual environment needed for this project. Please remember that if you exit the virtual environment and want to return to work on the project, you must re-run <code class="language-plaintext highlighter-rouge">source .venv/bin/activate</code>. This also means every time you re-ssh into the hive, you will have to re-run <code class="language-plaintext highlighter-rouge">source .venv/bin/activate</code>.</p>

<p>Then, run</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip3 <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
</code></pre></div></div>
<p>in the virtual environment. This will install all python packages you need for running your custom python tests.</p>

<p>Finally, if you have to exit out of the virtual environment, you can do so by running:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>deactivate
</code></pre></div></div>

<p><strong>We already have the reference library <code class="language-plaintext highlighter-rouge">dumbpy</code> installed for you on Hive machines.</strong> You can import it with or without the virtual environment while using python3.6, and all object and function names are the same as the <code class="language-plaintext highlighter-rouge">numc</code> module that you will implement (please refer to <a href="index.html#task-3">Task 3</a>). <strong>You will only be able to access the dumbpy package on hive as we will not be directly releasing it</strong>. You can use it as a reference for both correctness and speed.</p>

<p>Again, for this project, <strong>we strongly suggest working on Hive machines in your cs61c class account</strong>. <strong>You will not be able to import dumbpy if you are using other class accounts</strong>. We may be unable to help you with issues caused by working outside of the Hive.</p>

<h2 id="task-1-matrix-functions-in-c">Task 1: Matrix functions in C</h2>
<p>For this task, you will need to complete all functions in <strong><code class="language-plaintext highlighter-rouge">matrix.c</code></strong> labelled with
<code class="language-plaintext highlighter-rouge">/* TODO: YOUR CODE HERE */</code>. The comments above each function signature in <strong><code class="language-plaintext highlighter-rouge">matrix.c</code></strong> contain instructions on how to implement the functions, so read them carefully before you start coding.</p>

<p>The <code class="language-plaintext highlighter-rouge">matrix</code> struct is defined in <strong><code class="language-plaintext highlighter-rouge">matrix.h</code></strong>. Feel free to change it, but make sure your changes are compatible with our starter code.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="n">matrix</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">rows</span><span class="p">;</span>       <span class="c1">// number of rows</span>
  <span class="kt">int</span> <span class="n">cols</span><span class="p">;</span>       <span class="c1">// number of columns</span>
  <span class="kt">double</span> <span class="o">**</span><span class="n">data</span><span class="p">;</span>  <span class="c1">// each element is a pointer to a row of data</span>
  <span class="kt">int</span> <span class="n">is_1d</span><span class="p">;</span>      <span class="c1">// Whether this matrix is a 1d matrix</span>
                  <span class="c1">// For 1D matrix, shape is (rows * cols)</span>
  <span class="kt">int</span> <span class="n">ref_cnt</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">matrix</span> <span class="o">*</span><span class="n">parent</span><span class="p">;</span>
<span class="p">}</span> <span class="n">matrix</span><span class="p">;</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">rows</code> is the number of rows of this matrix, <code class="language-plaintext highlighter-rouge">cols</code> is the number of columns, and <code class="language-plaintext highlighter-rouge">data</code> is a 2D representation of the matrix data. <code class="language-plaintext highlighter-rouge">ref_cnt</code> is the number of existing <code class="language-plaintext highlighter-rouge">matrix</code> structs (including itself) that share all or part of the data array with this particular <code class="language-plaintext highlighter-rouge">matrix</code> struct. <code class="language-plaintext highlighter-rouge">is_1d</code> is non-zero if the number of rows is 1 or the number of columns is 1. <code class="language-plaintext highlighter-rouge">parent</code> indicates whether this <code class="language-plaintext highlighter-rouge">matrix</code> struct is a slice of another matrix, and should be set to its parent <code class="language-plaintext highlighter-rouge">matrix</code> struct if it is and <code class="language-plaintext highlighter-rouge">NULL</code> otherwise.</p>

<p><strong><code class="language-plaintext highlighter-rouge">matrix.h</code></strong> also imports the library <code class="language-plaintext highlighter-rouge">Python.h</code>, but for this part you should not need any other functions besides <code class="language-plaintext highlighter-rouge">PyErr_SetString</code>.</p>

<p>Depending on your implementation of <strong><code class="language-plaintext highlighter-rouge">matrix.c</code></strong> and <strong><code class="language-plaintext highlighter-rouge">numc.c</code></strong>, you may or may not assume that <code class="language-plaintext highlighter-rouge">result</code> is already preallocated or that all inputs’ dimensions are valid. However, as mentioned in the <a href="index.html#tip">Tips and Guidelines</a> section, your Python number methods will need to handle the case where matrix allocation fails.</p>

<p>Again, you may change any function signature in <strong><code class="language-plaintext highlighter-rouge">matrix.h</code></strong> and <strong><code class="language-plaintext highlighter-rouge">matrix.c</code></strong>.</p>

<div id="deallocate"></div>

<p><strong>Important notes</strong>:</p>
<ul>
  <li><strong>Remember to throw a runtime error if <code class="language-plaintext highlighter-rouge">allocate_matrix</code> or <code class="language-plaintext highlighter-rouge">allocate_matrix_ref</code> fails to allocate space, or a value error if you are trying to allocate matrices with non-positive dimensions!</strong> Otherwise you would have to make sure that a runtime/value error will be thrown in <strong><code class="language-plaintext highlighter-rouge">numc.c</code></strong> whenever we run out of memory. <strong>This includes throwing an error in Matrix61c_init</strong>.</li>
  <li><strong>Remember to set the <code class="language-plaintext highlighter-rouge">is_1d</code> field when initializing matrices in <code class="language-plaintext highlighter-rouge">allocate_matrix</code> or <code class="language-plaintext highlighter-rouge">allocate_matrix_ref</code>!</strong>. Since 1D matrices are printed out differently than 2D, autograder tests may fail if <code class="language-plaintext highlighter-rouge">is_1d</code> is not set correctly.</li>
  <li>The <code class="language-plaintext highlighter-rouge">deallocate</code> function as well as the <code class="language-plaintext highlighter-rouge">ref_cnt</code> field in the <code class="language-plaintext highlighter-rouge">matrix</code> struct have caused a lot of confusions in the past semesters. It is important to remember that this <code class="language-plaintext highlighter-rouge">ref_cnt</code> is <strong>NOT</strong> Python’s internal reference count. It is simply a field that will help you implement the <code class="language-plaintext highlighter-rouge">deallocate</code> function. It does not have to reflect the true reference count if you deem that setting it to other values will simplify your implementation of <code class="language-plaintext highlighter-rouge">deallocate</code>.</li>
  <li>For the <code class="language-plaintext highlighter-rouge">deallocate</code> function, since there can be multiple matrices that refer to the same data array in the memory, you must not free the data until you call <code class="language-plaintext highlighter-rouge">deallocate</code> on the last existing matrix that refers to that data. If you are having some difficulties implementing this, here’s a hint: you can keep the matrix struct in the memory even if you have already called <code class="language-plaintext highlighter-rouge">deallocate</code> on that matrix. <strong>You only need to make sure to that the struct is freed once the last matrix referring to its data is deallocated.</strong>
    <ul>
      <li>If this explanation does not make sense now, don’t worry! It will make more sense after you implement the <a href="index.html#indexing">indexing section</a> of task 3.</li>
    </ul>
  </li>
</ul>

<h3 id="testing-for-correctness">Testing for Correctness</h3>
<p>We’ve provided some sanity in <strong><code class="language-plaintext highlighter-rouge">mat_test.c</code></strong>. <strong>These tests make several assumptions:</strong></p>
<ul>
  <li>They assume that all result matrices are already pre-allocated with the correct dimensions and that all input dimensions are valid.</li>
  <li>They assume that you have not modified the <code class="language-plaintext highlighter-rouge">matrix</code> struct in <strong><code class="language-plaintext highlighter-rouge">matrix.h</code></strong></li>
  <li>All tests except the tests for <code class="language-plaintext highlighter-rouge">get</code> and <code class="language-plaintext highlighter-rouge">set</code> assume that your <code class="language-plaintext highlighter-rouge">get</code> and <code class="language-plaintext highlighter-rouge">set</code> are correct</li>
  <li>They assume that you have not modified the function signatures.</li>
</ul>

<p>Violation of one or more of these assumptions may not cause your tests to fail, but please keep this in mind if your tests are failing and you are violating at least one of these assumptions.</p>

<p>To run the CUnit tests, run</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make <span class="nb">test</span>
</code></pre></div></div>
<p>in the root folder of your project. This will create an executable called <strong><code class="language-plaintext highlighter-rouge">test</code></strong> in the root folder and run it.</p>

<p>By default, CUnit will run these tests in Normal mode. When debugging a specific issue, it may be helpful to switch to Verbose mode, which can be done by commenting and uncommenting the relevant lines in <code class="language-plaintext highlighter-rouge">mat_test.c</code>:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// CU_basic_set_mode(CU_BRM_NORMAL);</span>
<span class="n">CU_basic_set_mode</span><span class="p">(</span><span class="n">CU_BRM_VERBOSE</span><span class="p">);</span>
</code></pre></div></div>
<p>Make sure that one line is uncommented at a time.</p>

<p>Please keep in mind that these tests are not comprehensive, and passing all the sanity tests does not necessarily mean your implementation is correct. This is especially true with the memory functions <code class="language-plaintext highlighter-rouge">allocate_matrix</code>, <code class="language-plaintext highlighter-rouge">allocate_matrix_ref</code>, and <code class="language-plaintext highlighter-rouge">deallocate_matrix</code>. Also keep in mind that the autograder will be using our own set of sanity tests. We will not directly test your C code, and will not be running your CUnit tests.</p>

<p>Another thing to note is that the <strong><code class="language-plaintext highlighter-rouge">Makefile</code></strong> is written for compilation on the hive machines. If you wish to run it locally, you will have to modify the <strong><code class="language-plaintext highlighter-rouge">Makefile</code></strong> by replacing the path to your CUnit/Python libraries in your <code class="language-plaintext highlighter-rouge">CUNIT</code> and <code class="language-plaintext highlighter-rouge">PYTHON</code> variables. You will also need to make sure that your local computer supports AVX extensions and OpenMP.</p>

<p>Finally, you are welcomed to modify <strong><code class="language-plaintext highlighter-rouge">mat_test.c</code></strong> to implement your custom test cases.</p>

<h2 id="task-2-writing-the-setup-file">Task 2: Writing the setup file</h2>
<p>The <code class="language-plaintext highlighter-rouge">setup.py</code> file is used for installing your custom-built modules. After completing it, you should be able to install <code class="language-plaintext highlighter-rouge">numc</code> by simply running:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make
</code></pre></div></div>
<p>This will uninstall your previously installed <code class="language-plaintext highlighter-rouge">numc</code> module if it existed and reinstall <code class="language-plaintext highlighter-rouge">numc</code>. We have written <code class="language-plaintext highlighter-rouge">numc.c</code> so that <code class="language-plaintext highlighter-rouge">numc.Matrix</code> will be initialized and ready to import upon succesful installation of the <code class="language-plaintext highlighter-rouge">numc</code> module. You should rerun <code class="language-plaintext highlighter-rouge">make</code> every time you make changes and want them to be reflected in the <code class="language-plaintext highlighter-rouge">numc</code> module.</p>

<p>You can uninstall your <code class="language-plaintext highlighter-rouge">numc</code> module by running</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>make uninstall
</code></pre></div></div>

<p>We have provided you with the compiler and linker flags in <code class="language-plaintext highlighter-rouge">setup.py</code>, and your task is to find out how to use them to build your module.</p>

<p>You will likely get a lot of warnings about functions being defined but not used, and that’s ok! You should ignore these warnings for now, and they will be gone after you finish writing Task 3.</p>

<p>Remember that <strong>you must be in the virtual environment that you set up in order to install the modules</strong>, otherwise you will get a “Read-only file system” error.</p>

<p><strong>READ FIRST</strong>: take a look at the function <code class="language-plaintext highlighter-rouge">distutils.core.setup</code> (<a href="https://docs.python.org/3.6/distutils/apiref.html">https://docs.python.org/3.6/distutils/apiref.html</a>), and here is an <a href="https://docs.python.org/3.6/extending/building.html">example usage</a>. If the documentation seems too difficult to understand, it is a good idea to take a look at the example first. You only need two function calls to complete this section, if you’re doing more than that, please reread the docs included as you’re likely doing something wrong</p>

<div id="task-3"></div>

<h2 id="task-3-writing-the-python-c-interface">Task 3: Writing the Python-C interface</h2>
<p>Now that you have successfully installed your <code class="language-plaintext highlighter-rouge">numc</code> module, you can import your <code class="language-plaintext highlighter-rouge">numc.Matrix</code> objects in Python programs! Here are some ready-to-use features already implemented for <code class="language-plaintext highlighter-rouge">numc.Matrix</code> objects. You might find them helpful when debugging Task 3.</p>

<h3 id="info-importing-numcmatrix">Info: Importing <code class="language-plaintext highlighter-rouge">numc.Matrix</code></h3>
<p>Here are several ways of importing <code class="language-plaintext highlighter-rouge">numc.Matrix</code></p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">numc</span> <span class="kn">import</span> <span class="n">Matrix</span>

<span class="kn">import</span> <span class="nn">numc</span>
<span class="n">numc</span><span class="p">.</span><span class="n">Matrix</span>

<span class="kn">import</span> <span class="nn">numc</span> <span class="k">as</span> <span class="n">nc</span>
<span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span>
</code></pre></div></div>

<h3 id="info-numcmatrix-initialization">Info: <code class="language-plaintext highlighter-rouge">numc.Matrix</code> initialization</h3>
<p>Here are all the different ways of creating a <code class="language-plaintext highlighter-rouge">numc.Matrix</code> object.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numc</span> <span class="k">as</span> <span class="n">nc</span>
<span class="n">CS61C</span> <span class="n">Fall</span> <span class="mi">2020</span> <span class="n">Project</span> <span class="mi">4</span><span class="p">:</span> <span class="n">numc</span> <span class="n">imported</span><span class="err">!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c1"># This creates a 3 * 3 matrix with entries all zeros
</span><span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># This creates a 3 * 3 matrix with entries all ones
</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span> <span class="c1"># This creates a 2 * 3 matrix with first row 1, 2, 3, second row 4, 5, 6
</span><span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span> <span class="c1"># This creates a 1 * 2 matrix with entries 4, 5
</span><span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]</span>
</code></pre></div></div>

<p>More specifically:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">nc.Matrix(rows: int, cols: int)</code> will create a matrix with <code class="language-plaintext highlighter-rouge">rows</code> rows and <code class="language-plaintext highlighter-rouge">cols</code> cols. All entries in this matrix are defaulted to 0.</li>
  <li><code class="language-plaintext highlighter-rouge">nc.Matrix(rows: int, cols: int, val: float/int)</code> will create a matrix with <code class="language-plaintext highlighter-rouge">rows</code> rows and <code class="language-plaintext highlighter-rouge">cols</code> cols. All entries in this matrix will be initialized to <code class="language-plaintext highlighter-rouge">val</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">nc.Matrix(rows: int, cols: int, lst: List[int/float])</code> will create a matrix with <code class="language-plaintext highlighter-rouge">rows</code> rows and <code class="language-plaintext highlighter-rouge">cols</code> cols. <code class="language-plaintext highlighter-rouge">lst</code> must have length <code class="language-plaintext highlighter-rouge">rows * cols</code>, and entries of the matrix will be initialized to values of <code class="language-plaintext highlighter-rouge">lst</code> in a row-major order.</li>
  <li><code class="language-plaintext highlighter-rouge">nc.Matrix(lst: List[List[int/float]])</code> will create a matrix with the same shape as the 2D <code class="language-plaintext highlighter-rouge">lst</code> (i.e. each list in <code class="language-plaintext highlighter-rouge">lst</code> is a row for this matrix).</li>
</ul>

<h3 id="info-instance-attributes">Info: instance attributes</h3>
<p>The matrices and vectors have an attribute shape. For a 2D matrix, it is a tuple of <code class="language-plaintext highlighter-rouge">(rows, cols)</code>. For a 1D matrix, it is a one-element tuple of <code class="language-plaintext highlighter-rouge">(number of elements, )</code>
Example is given below.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numc</span> <span class="k">as</span> <span class="n">nc</span>
<span class="n">CS61C</span> <span class="n">Fall</span> <span class="mi">2020</span> <span class="n">Project</span> <span class="mi">4</span><span class="p">:</span> <span class="n">numc</span> <span class="n">imported</span><span class="err">!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mat</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mat</span><span class="p">.</span><span class="n">shape</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mat</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mat</span><span class="p">.</span><span class="n">shape</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,)</span>
</code></pre></div></div>
<p>Because 1D matrices’ shapes are tricky, <strong>we are NOT testing matrix operations on your 1D matrices</strong>.</p>

<h3 id="info-pythonc-api-reference">Info: Python/C API Reference</h3>
<p>Here is the link to the full reference manual: <a href="https://docs.python.org/3.6/c-api/index.html">https://docs.python.org/3.6/c-api/index.html</a>. If you ever find anything confusing in the skeleton code or are at a lost on how to implement <strong><code class="language-plaintext highlighter-rouge">numc.c</code></strong>, this is a great resource.</p>

<hr />
<h3 id="quick-overview-of-numc-skeleton-code">Quick Overview of <code class="language-plaintext highlighter-rouge">numc</code> skeleton code</h3>

<p>We define the <code class="language-plaintext highlighter-rouge">Matrix61c</code> struct in <strong><code class="language-plaintext highlighter-rouge">numc.h</code></strong>. It is of type <code class="language-plaintext highlighter-rouge">PyObject</code> (this means you can always cast <code class="language-plaintext highlighter-rouge">Matrix61c</code> to <code class="language-plaintext highlighter-rouge">PyObject</code>, but not vice versa), which according to the official documentation, “contains the information Python needs to treat a pointer to an object as an object”. Our <code class="language-plaintext highlighter-rouge">Matrix61c</code> has the <code class="language-plaintext highlighter-rouge">matrix</code> struct we defined in <strong><code class="language-plaintext highlighter-rouge">matrix.h</code></strong>.</p>

<p>Then we define a struct <code class="language-plaintext highlighter-rouge">PyTypeObject</code> named <code class="language-plaintext highlighter-rouge">Matrix61cType</code> to specify the intended behaviors of our Python object <code class="language-plaintext highlighter-rouge">Matrix61c</code>. This struct will then be initialized to be our <code class="language-plaintext highlighter-rouge">numc.Matrix</code> objects.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="n">PyTypeObject</span> <span class="n">Matrix61cType</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">PyVarObject_HEAD_INIT</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">.</span><span class="n">tp_name</span> <span class="o">=</span> <span class="s">"numc.Matrix"</span><span class="p">,</span>
    <span class="p">.</span><span class="n">tp_basicsize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Matrix61c</span><span class="p">),</span>
    <span class="p">.</span><span class="n">tp_dealloc</span> <span class="o">=</span> <span class="p">(</span><span class="n">destructor</span><span class="p">)</span><span class="n">Matrix61c_dealloc</span><span class="p">,</span>
    <span class="p">.</span><span class="n">tp_repr</span> <span class="o">=</span> <span class="p">(</span><span class="n">reprfunc</span><span class="p">)</span><span class="n">Matrix61c_repr</span><span class="p">,</span>
    <span class="p">.</span><span class="n">tp_as_number</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Matrix61c_as_number</span><span class="p">,</span>
    <span class="p">.</span><span class="n">tp_flags</span> <span class="o">=</span> <span class="n">Py_TPFLAGS_DEFAULT</span> <span class="o">|</span>
        <span class="n">Py_TPFLAGS_BASETYPE</span><span class="p">,</span>
    <span class="p">.</span><span class="n">tp_doc</span> <span class="o">=</span> <span class="s">"numc.Matrix objects"</span><span class="p">,</span>
    <span class="p">.</span><span class="n">tp_methods</span> <span class="o">=</span> <span class="n">Matrix61c_methods</span><span class="p">,</span>
    <span class="p">.</span><span class="n">tp_members</span> <span class="o">=</span> <span class="n">Matrix61c_members</span><span class="p">,</span>
    <span class="p">.</span><span class="n">tp_as_mapping</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">Matrix61c_mapping</span><span class="p">,</span>
    <span class="p">.</span><span class="n">tp_init</span> <span class="o">=</span> <span class="p">(</span><span class="n">initproc</span><span class="p">)</span><span class="n">Matrix61c_init</span><span class="p">,</span>
    <span class="p">.</span><span class="n">tp_new</span> <span class="o">=</span> <span class="n">Matrix61c_new</span>
<span class="p">};</span>
</code></pre></div></div>
<p>For example, <code class="language-plaintext highlighter-rouge">.tp_dealloc</code> tells Python which function to call to destroy a <code class="language-plaintext highlighter-rouge">numc.Matrix</code> object when its reference count becomes 0, and <code class="language-plaintext highlighter-rouge">.tp_members</code> tells Python what instance attributes <code class="language-plaintext highlighter-rouge">numc.Matrix</code> objects have. You can take a look at the <a href="https://docs.python.org/3.6/c-api/typeobj.html">official documentation</a> if you are curious.</p>

<h3 id="useful-functions">Useful functions:</h3>
<p>Here is a list of some functions and Python objects from <code class="language-plaintext highlighter-rouge">&lt;Python.h&gt;</code> that you may find useful. You can also choose any other functions at this <a href="https://docs.python.org/3.6/c-api/index.html">link</a>.</p>
<ul>
  <li><a href="https://docs.python.org/3.6/c-api/object.html">PyObject_TypeCheck</a></li>
  <li><a href="https://docs.python.org/3.6/c-api/exceptions.html">PyErr_SetString</a></li>
  <li><a href="https://docs.python.org/3.6/c-api/arg.html">Py_BuildValue</a></li>
  <li><a href="https://docs.python.org/3.6/c-api/tuple.html">PyTupleObject</a></li>
  <li><a href="https://docs.python.org/3.6/c-api/long.html">PyLongObject</a></li>
  <li><a href="https://docs.python.org/3.6/c-api/float.html">PyFloatObject</a></li>
  <li><a href="https://docs.python.org/3.6/c-api/list.html">PyListObject</a></li>
</ul>

<hr />
<p>Now you are ready to complete <strong><code class="language-plaintext highlighter-rouge">numc.c</code></strong>, the Python-C interface! As before, you will need to fill out all functions and variables labeled <code class="language-plaintext highlighter-rouge">/* TODO: YOUR CODE HERE */</code>. The code for initializing the module <code class="language-plaintext highlighter-rouge">numc</code> and the object type <code class="language-plaintext highlighter-rouge">numc.Matrix</code> is already done for you. Although not required, we encourage you to take a look at the existing code to better understand the interface.</p>

<p>Below are the three main parts for this task.</p>

<p><strong>Note: For each of the function below, we specify when you should throw each type of error. For any errors not specified, throw a runtime error.</strong></p>

<h3 id="number-methods">Number Methods</h3>
<p>For this part, we ask you to overload operators for <code class="language-plaintext highlighter-rouge">numc.Matrix</code> objects. Here are the expected behaviors of overloaded operators:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">a + b</code>: Element-wise sum of <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code>. Returns a <code class="language-plaintext highlighter-rouge">numc.Matrix</code> object.
    <ul>
      <li>Throwing errors:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">TypeError</code> if <code class="language-plaintext highlighter-rouge">b</code> is not of type <code class="language-plaintext highlighter-rouge">numc.Matrix</code>.</li>
          <li><code class="language-plaintext highlighter-rouge">ValueError</code> if <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> do not have the same dimensions.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">a - b</code>: Element-wise subtraction of <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code>. Returns a <code class="language-plaintext highlighter-rouge">numc.Matrix</code> object.
    <ul>
      <li>Throwing errors:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">TypeError</code> if <code class="language-plaintext highlighter-rouge">b</code> is not of type <code class="language-plaintext highlighter-rouge">numc.Matrix</code>.</li>
          <li><code class="language-plaintext highlighter-rouge">ValueError</code> if <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> do not have the same dimensions.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">a * b</code>: Matrix multiplication of <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code>. Returns a <code class="language-plaintext highlighter-rouge">numc.Matrix</code> object. Remember that this is a matrix multiplication, not an element-wise multiplication.
    <ul>
      <li>Throwing errors:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">TypeError</code> if <code class="language-plaintext highlighter-rouge">b</code> is not of type <code class="language-plaintext highlighter-rouge">numc.Matrix</code></li>
          <li><code class="language-plaintext highlighter-rouge">ValueError</code> if <code class="language-plaintext highlighter-rouge">a</code>’s number of columns is not equal to <code class="language-plaintext highlighter-rouge">b</code>’s number of rows.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">-a</code>: Element-wise negation of <code class="language-plaintext highlighter-rouge">a</code>. Returns a <code class="language-plaintext highlighter-rouge">numc.Matrix</code> object.</li>
  <li><code class="language-plaintext highlighter-rouge">abs(a)</code>: Element-wise absolute value of <code class="language-plaintext highlighter-rouge">a</code>. Returns a <code class="language-plaintext highlighter-rouge">numc.Matrix</code> object.</li>
  <li><code class="language-plaintext highlighter-rouge">a ** pow</code>: Raise <code class="language-plaintext highlighter-rouge">a</code> to the <code class="language-plaintext highlighter-rouge">pow</code>th power. <code class="language-plaintext highlighter-rouge">a</code> to the 0th power is the identity matrix (1 on the top left to bottom right diagonal and 0 everywhere else). Returns a <code class="language-plaintext highlighter-rouge">numc.Matrix</code> object. This operator is defined in terms of matrix multiplication, not element-wise multiplication.
    <ul>
      <li>Throwing errors:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">TypeError</code> if <code class="language-plaintext highlighter-rouge">pow</code> is not an integer.</li>
          <li><code class="language-plaintext highlighter-rouge">ValueError</code> if <code class="language-plaintext highlighter-rouge">a</code> is not a square matrix or if <code class="language-plaintext highlighter-rouge">pow</code> is negative.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><strong>Please note that for all these operations above, you must never directly modify the matrix that you pass in.</strong> You always make a new <code class="language-plaintext highlighter-rouge">numc.Matrix</code> object to hold your result, so make sure you set the <code class="language-plaintext highlighter-rouge">shape</code> attribute of the new <code class="language-plaintext highlighter-rouge">numc.Matrix</code>. You can use <code class="language-plaintext highlighter-rouge">Matrix61c_new</code> to create new <code class="language-plaintext highlighter-rouge">numc.Matrix</code> objects. For your convenience, here’s an example of how you create a <code class="language-plaintext highlighter-rouge">numc.Matrix</code>.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* Assume new_mat is a matrix struct */</span>
<span class="n">Matrix61c</span> <span class="o">*</span><span class="n">rv</span> <span class="o">=</span> <span class="p">(</span><span class="n">Matrix61c</span> <span class="o">*</span><span class="p">)</span> <span class="n">Matrix61c_new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Matrix61cType</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="n">rv</span><span class="o">-&gt;</span><span class="n">mat</span> <span class="o">=</span> <span class="n">new_mat</span><span class="p">;</span>
<span class="cm">/* Set the shape of this numc.Matrix */</span>
<span class="n">rv</span><span class="o">-&gt;</span><span class="n">shape</span> <span class="o">=</span> <span class="p">...;</span> 
</code></pre></div></div>

<p>For all the functions above, throw a runtime error if any error occurs (such as matrix allocation failure) and causes the operation to fail. Moreover, for any operations that involve two instances of <code class="language-plaintext highlighter-rouge">numc.Matrix</code>, you will have to make sure that the second instance <code class="language-plaintext highlighter-rouge">b</code> is indeed of type <code class="language-plaintext highlighter-rouge">numc.Matrix</code> as we do not support operations between <code class="language-plaintext highlighter-rouge">numc.Matrix</code> and other data/object types. <strong>Please read the comments in <code class="language-plaintext highlighter-rouge">numc.c</code> carefully</strong>.</p>

<p>Here is a table that tells you which function in <strong><code class="language-plaintext highlighter-rouge">numc.c</code></strong> in which you will implement each of the above operators</p>

<table>
  <thead>
    <tr>
      <th>Operator</th>
      <th style="text-align: left">Function</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>+</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">Matrix61c_add</code></td>
    </tr>
    <tr>
      <td>- (subtraction)</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">Matrix61c_sub</code></td>
    </tr>
    <tr>
      <td>*</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">Matrix61c_multiply</code></td>
    </tr>
    <tr>
      <td>- (negation)</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">Matrix61c_neg</code></td>
    </tr>
    <tr>
      <td>abs()</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">Matrix61c_abs</code></td>
    </tr>
    <tr>
      <td>**</td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">Matrix61c_pow</code></td>
    </tr>
  </tbody>
</table>

<p>All these functions will be called through a Python-C interface after you complete the <code class="language-plaintext highlighter-rouge">numc</code> module. In other words, these are the functions that will be called when you do matrix operations with <code class="language-plaintext highlighter-rouge">numc.Matrix</code> objects, and these interface methods will call <strong><code class="language-plaintext highlighter-rouge">matrix.c</code></strong> methods that you just implemented. You will have to check for the validity of the dimensions before actually carrying out the arithmetic, and throw an error if needed. Specifically, throw a value error if the arguments’ dimensions are invalid, and a runtime error if any memory allocation fails during execution. Again, depending on your implementation, these error checks could either be in <strong><code class="language-plaintext highlighter-rouge">matrix.c</code></strong> or <strong><code class="language-plaintext highlighter-rouge">numc.c</code></strong></p>

<p>After you implement all the functions above, you will need to fill out the struct <code class="language-plaintext highlighter-rouge">Matrix61c_as_number</code>, which is used to define the object type <code class="language-plaintext highlighter-rouge">numc.Matrix</code>.</p>

<p>Here is the link to the official documentation of a <code class="language-plaintext highlighter-rouge">PyNumberMethods</code> struct: <a href="https://docs.python.org/3/c-api/typeobj.html#c.PyNumberMethods">https://docs.python.org/3/c-api/typeobj.html#c.PyNumberMethods</a></p>

<h3 id="instance-methods">Instance Methods</h3>
<p>You will implement two instance methods for <code class="language-plaintext highlighter-rouge">numc.Matrix</code>:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">set(self, i, j, val)</code>: Set <code class="language-plaintext highlighter-rouge">self</code>’s entry at the <code class="language-plaintext highlighter-rouge">i</code>th row and <code class="language-plaintext highlighter-rouge">j</code>th column to <code class="language-plaintext highlighter-rouge">val</code>.
    <ul>
      <li>Throwing errors:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">TypeError</code> if the number of arguments parsed from args is not 3, if <code class="language-plaintext highlighter-rouge">i</code> and <code class="language-plaintext highlighter-rouge">j</code> are not integers, or if <code class="language-plaintext highlighter-rouge">val</code> is not a float or int.</li>
          <li><code class="language-plaintext highlighter-rouge">IndexError</code> if <code class="language-plaintext highlighter-rouge">i</code> or <code class="language-plaintext highlighter-rouge">j</code> or both are out of range.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">get(self, i, j)</code>: Returns the entry at the <code class="language-plaintext highlighter-rouge">i</code>th row and <code class="language-plaintext highlighter-rouge">j</code>th column. Throw a type error if the number of arguments parsed from args is not 2 or if the arguments are of the wrong types. Throw an index error if either <code class="language-plaintext highlighter-rouge">i</code>, <code class="language-plaintext highlighter-rouge">j</code>, or both are out of range. Return value is a Python float.
    <ul>
      <li>Throwing errors:
        <ul>
          <li><code class="language-plaintext highlighter-rouge">TypeError</code> if the number of arguments parsed from args is not 2 or if either <code class="language-plaintext highlighter-rouge">i</code> or <code class="language-plaintext highlighter-rouge">j</code> is not an integer.</li>
          <li><code class="language-plaintext highlighter-rouge">IndexError</code> if <code class="language-plaintext highlighter-rouge">i</code> or <code class="language-plaintext highlighter-rouge">j</code> or both are out of range.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>These functions will call <code class="language-plaintext highlighter-rouge">get</code> and <code class="language-plaintext highlighter-rouge">set</code> in <strong><code class="language-plaintext highlighter-rouge">matrix.c</code></strong> to actually get or set the value. Again, you can throw errors either in <strong><code class="language-plaintext highlighter-rouge">numc.c</code></strong> or <strong><code class="language-plaintext highlighter-rouge">matrix.c</code></strong>.</p>

<p>Here is a table that tells you which functions in <strong><code class="language-plaintext highlighter-rouge">numc.c</code></strong> in which you will implement each of the above instance methods</p>

<table>
  <thead>
    <tr>
      <th>Python method</th>
      <th style="text-align: left">C Function</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">set</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">Matrix61c_set_value</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">get</code></td>
      <td style="text-align: left"><code class="language-plaintext highlighter-rouge">Matrix61c_get_value</code></td>
    </tr>
  </tbody>
</table>

<p>After you implement all the functions above, you will need to fill out the array of  <code class="language-plaintext highlighter-rouge">PyMethodDef</code> structs <code class="language-plaintext highlighter-rouge">Matrix61c_methods</code>, which is used to define the object type <code class="language-plaintext highlighter-rouge">numc.Matrix</code>.</p>

<p>This link tells you what goes into a <code class="language-plaintext highlighter-rouge">PyMethodDef</code> struct: <a href="https://docs.python.org/3/c-api/structures.html">https://docs.python.org/3/c-api/structures.html</a></p>

<div id="indexing"></div>

<h3 id="indexing">Indexing</h3>
<p>After finishing this part, you should be able to index into a matrix and change either the value of one single entry or a slice. You will need to complete the following two functions:</p>
<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">static PyObject *Matrix61c_subscript(Matrix61c *self, PyObject *key)</code></strong>
    <ul>
      <li>This function takes in a <code class="language-plaintext highlighter-rouge">numc</code> matrix and the key to index into the matrix. For a 2D matrix, the key could either be an integer, a single slice, or a tuple of two slices/ints. For a 1D matrix, the key could either be an integer or a single slice. Below we provide an example for each case.
        <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numc</span> <span class="k">as</span> <span class="n">nc</span>
  <span class="n">CS61C</span> <span class="n">Fall</span> <span class="mi">2020</span> <span class="n">Project</span> <span class="mi">4</span><span class="p">:</span> <span class="n">numc</span> <span class="n">imported</span><span class="err">!</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> 
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Key is a single number
</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># key is a single slice
</span>  <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># key is a tuple of two slices
</span>  <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1"># key is a tuple of (slice, int)
</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># key is a tuple of (int, slice)
</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="c1"># key is a tuple of (int, int)
</span>  <span class="mf">0.0</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c1"># b is a 1D matrix
</span>  <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="mf">0.0</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># Number of rows/cols does not matter now. You are slicing it as if it were a list
</span>  <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># This is invalid!
</span>  <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
    <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
  <span class="nb">TypeError</span><span class="p">:</span> <span class="mi">1</span><span class="n">D</span> <span class="n">matrices</span> <span class="n">only</span> <span class="n">support</span> <span class="n">single</span> <span class="nb">slice</span><span class="err">!</span>
</code></pre></div>        </div>
      </li>
      <li>This function returns a single number if the resulting slice is 1 by 1, otherwise it returns a new matrix that shares its data with its parent matrix. Here are more examples.
        <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numc</span> <span class="k">as</span> <span class="n">nc</span>
  <span class="n">CS61C</span> <span class="n">Fall</span> <span class="mi">2020</span> <span class="n">Project</span> <span class="mi">4</span><span class="p">:</span> <span class="n">numc</span> <span class="n">imported</span><span class="err">!</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
  <span class="mf">0.0</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
  <span class="mf">0.0</span>
</code></pre></div>        </div>
      </li>
      <li>When the target matrix is 1D, then it does not matter whether it has 0 row or 0 column when you are indexing it. If <code class="language-plaintext highlighter-rouge">key</code> is an integer, then <code class="language-plaintext highlighter-rouge">mat[key]</code> should return the <code class="language-plaintext highlighter-rouge">key</code>th element of the matrix. If <code class="language-plaintext highlighter-rouge">key</code> is a single slice with <code class="language-plaintext highlighter-rouge">start</code> and <code class="language-plaintext highlighter-rouge">stop</code>, then <code class="language-plaintext highlighter-rouge">mat[start:stop]</code> should return another 1D matrix with <code class="language-plaintext highlighter-rouge">stop - start</code> elements. For example
        <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numc</span> <span class="k">as</span> <span class="n">nc</span>
<span class="n">CS61C</span> <span class="n">Fall</span> <span class="mi">2020</span> <span class="n">Project</span> <span class="mi">4</span><span class="p">:</span> <span class="n">numc</span> <span class="n">imported</span><span class="err">!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="mf">1.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="mf">1.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
</code></pre></div>        </div>
      </li>
      <li>Throwing errors:
        <ul>
          <li>If matrix is 2D, <code class="language-plaintext highlighter-rouge">TypeError</code> if <code class="language-plaintext highlighter-rouge">key</code> is not an integer, a slice, or a length-2 tuple of slices/ints. If matrix is 1D, <code class="language-plaintext highlighter-rouge">TypeError</code> if <code class="language-plaintext highlighter-rouge">key</code> is not an integer or a slice.</li>
          <li><code class="language-plaintext highlighter-rouge">ValueError</code> if <code class="language-plaintext highlighter-rouge">key</code> is a slice or a tuple that has one or more slices, and that at least one of these slices has step size not equal to 1, or if the length of slice is &lt; 1. Here we provide an example for each error case to help you better understand them.
            <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numc</span> <span class="k">as</span> <span class="n">nc</span>
  <span class="n">CS61C</span> <span class="n">Fall</span> <span class="mi">2020</span> <span class="n">Project</span> <span class="mi">4</span><span class="p">:</span> <span class="n">numc</span> <span class="n">imported</span><span class="err">!</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># Step size != 1
</span>  <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
    <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
  <span class="nb">ValueError</span><span class="p">:</span> <span class="n">Slice</span> <span class="n">info</span> <span class="ow">not</span> <span class="n">valid</span><span class="err">!</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Slice has length &lt; 1
</span>  <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
    <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
  <span class="nb">ValueError</span><span class="p">:</span> <span class="n">Slice</span> <span class="n">info</span> <span class="ow">not</span> <span class="n">valid</span><span class="err">!</span>
</code></pre></div>            </div>
          </li>
          <li><code class="language-plaintext highlighter-rouge">IndexError</code> if <code class="language-plaintext highlighter-rouge">key</code> is an integer but is out of range, or if <code class="language-plaintext highlighter-rouge">key</code> is a tuple with at least one integer in it, and the integer is out of range.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">static int Matrix61c_set_subscript(Matrix61c *self, PyObject *key, PyObject *v)</code></strong>
    <ul>
      <li>This function takes in a <code class="language-plaintext highlighter-rouge">numc</code> matrix, the key <code class="language-plaintext highlighter-rouge">key</code> to index into the matrix, and the value <code class="language-plaintext highlighter-rouge">v</code> to which to set the new slice. Again, the key could either be an integer, a single slice, or a tuple of two slices/ints. If the resulting slice after indexing is 1 by 1, then <code class="language-plaintext highlighter-rouge">v</code> should be an integer or a float. If it is an 1D matrix (1 by n or n by 1), then <code class="language-plaintext highlighter-rouge">v</code> should be a list of numbers, and each number can either be int or float, and the length of the list should be the same as the number of elements of this slice. If it is 2D, then <code class="language-plaintext highlighter-rouge">v</code> should be a 2D list where the ith element of this list is a 1D list of integers/floats to set the ith row of the slice. Below we provide an example for each case.
        <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numc</span> <span class="k">as</span> <span class="n">nc</span>
  <span class="n">CS61C</span> <span class="n">Fall</span> <span class="mi">2020</span> <span class="n">Project</span> <span class="mi">4</span><span class="p">:</span> <span class="n">numc</span> <span class="n">imported</span><span class="err">!</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="c1"># Resulting slice is 1 by 1
</span>  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># Resulting slice is 1D
</span>  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
  <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># Resulting slice is 1D
</span>  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
  <span class="p">[[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span> <span class="c1"># Resulting slice is 2D
</span>  <span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
  <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
</code></pre></div>        </div>
      </li>
      <li>Throwing errors: <strong>In addition to the errors you have to throw for invalid key types/values (see <code class="language-plaintext highlighter-rouge">Matrix61c_subscript</code>)</strong>, you will also have to throw
        <ul>
          <li><code class="language-plaintext highlighter-rouge">TypeError</code> if
            <ul>
              <li>Resulting slice is 1 by 1, but <code class="language-plaintext highlighter-rouge">v</code> is not a float or int.</li>
              <li>Resulting slice is not 1 by 1, but <code class="language-plaintext highlighter-rouge">v</code> is not a list.</li>
            </ul>
          </li>
          <li><code class="language-plaintext highlighter-rouge">ValueError</code> if
            <ul>
              <li>Resulting slice is 1D, but <code class="language-plaintext highlighter-rouge">v</code> has the wrong length, or if any element of <code class="language-plaintext highlighter-rouge">v</code> is not a float or int.</li>
              <li>Resulting slice is 2D, but <code class="language-plaintext highlighter-rouge">v</code> has the wrong length, or if any element of <code class="language-plaintext highlighter-rouge">v</code> has the wrong length, or if any element of an element of <code class="language-plaintext highlighter-rouge">v</code> is not a float or int.</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>We suggest that you use <code class="language-plaintext highlighter-rouge">PySlice_GetIndicesEx</code> to extract the slices’ information. Here is the <a href="https://docs.python.org/3.6/c-api/slice.html">link</a> to the documentation of this function. Moreover, you should note that slices share data with their original matrix. This means that by changing values of the slices, the values of the original matrices should also change. Here are some examples.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numc</span> <span class="k">as</span> <span class="n">nc</span>
<span class="n">CS61C</span> <span class="n">Fall</span> <span class="mi">2020</span> <span class="n">Project</span> <span class="mi">4</span><span class="p">:</span> <span class="n">numc</span> <span class="n">imported</span><span class="err">!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]]</span>
</code></pre></div></div>
<p>Also note that it is possible to have nested slices, and changing the nested slices’ data should also change the original matrices’ data. For example,</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numc</span> <span class="k">as</span> <span class="n">nc</span>
<span class="n">CS61C</span> <span class="n">Fall</span> <span class="mi">2020</span> <span class="n">Project</span> <span class="mi">4</span><span class="p">:</span> <span class="n">numc</span> <span class="n">imported</span><span class="err">!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">nc</span><span class="p">.</span><span class="n">Matrix</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="c1"># Changing c should change both a and b
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">c</span>
<span class="p">[[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
<span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
</code></pre></div></div>

<p>Now, if you didn’t fully understand what the <code class="language-plaintext highlighter-rouge">deallocate</code> function is supposed to do when you were implementation task 1, it is now a good time to go <a href="index.html#deallocate">back</a> and take another look at it.</p>

<p>Again, make sure to set the <code class="language-plaintext highlighter-rouge">shape</code> attribute of the new slice that you make!</p>

<h3 id="testing">Testing</h3>
<p>Refer to <a href="index.html#unittest">this section</a> for instructions on how to test your program.</p>

<hr />

<h3 id="how-to-debug">How to Debug</h3>
<p>To debug the Python-C interface, we suggest that you write your test files in Python, and use gdb or both gdb and pdb to debug.</p>

<div id="only-gdb"></div>

<h4 id="using-only-gdb">Using only gdb</h4>
<p>You don’t have to use pdb if you do not wish to set breakpoints in your Python test file. Open your terminal and run</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gdb python
</code></pre></div></div>
<p>Then you can set breakpoints in your C files using the normal gdb commands. gdb will warn you with</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>No source file named {your c file}
Make breakpoint pending on future shared library load? (y or [n])
</code></pre></div></div>
<p>Press ‘y’ (without the quotes) to proceed.</p>

<p>After that, you can run <code class="language-plaintext highlighter-rouge">run {your python test file name}.py</code> in gdb, and gdb will break at the breakpoints that you just set.</p>

<h4 id="using-both-gdb-and-pdb">Using both gdb and pdb</h4>
<p>You will have to use pdb if you wish to set breakpoints in your Python file. Here’s how it works. Start gdb by running</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gdb python3
</code></pre></div></div>
<p>and set your breakpoints in C (see <a href="index.html#only-gdb">previous section</a>). Then you will need to run in gdb</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>run <span class="nt">-m</span> pdb <span class="o">{</span>your python file<span class="o">}</span>.py
</code></pre></div></div>
<p>After this step, you can set breakpoints in your Python file using gdb syntax (for example, <code class="language-plaintext highlighter-rouge">b test.py:5</code>). With this approach, your debugger will switch between pdb and gdb depending on whether you are stepping through a Python file or a C file.</p>

<h2 id="task-4-speeding-up-matrix-operations">Task 4: Speeding up matrix operations</h2>
<p>Now that you have completed the three steps above and successfully installed your naive version of <code class="language-plaintext highlighter-rouge">numc</code>, it’s time to speed up your matrix functions in <strong><code class="language-plaintext highlighter-rouge">matrix.c</code></strong>! <strong>As of now, we are only testing PERFORMANCE on non-slice matrices. Although we ARE testing the correctness of matrix operations on matrix slices.</strong>
Below we outline some steps for boosting performance.</p>

<h3 id="step-1-unrolling-and-other-optimizations">Step 1: Unrolling and Other Optimizations</h3>
<p>You should first try to speed up the computation by trying to apply conventional code optimizations (i.e. without using SSE or OpenMP). While we won’t tell you the exact steps, here are some hints that should help you get started:</p>

<ol>
  <li>Function calls are expensive since they involve setting up a stack frame and jumping to a different part of code. See if there are any functions that are frequently called that don’t necessarily need to be.</li>
  <li>Are there any places where you could do manual loop unrolling?</li>
  <li>Is there any unnecessary computation being done?</li>
</ol>

<p>Note that the above hints relate to general optimization practices. You do not necessarily need to do all of these to achieve a good speedup.</p>

<p>Once you have improved performance using these optimizations, you can start applying vectorization and parallelization to make the program even faster. Note that you have considerable freedom to apply any of these optimizations, and there is more than one correct solution. Try to experiment with different approaches and see which one gives you the best performance.</p>

<h3 id="step-2-simd-instructions">Step 2: SIMD Instructions</h3>
<p>From lectures, you learned how to apply SIMD instructions to improve performance. The processors in the hive machines support the Intel AVX extensions, which allow you to do SIMD operations on 256 bit values (not just 128 bit, as we have seen in the lab). You should use these extensions to perform four operations in parallel (since all floating point numbers are doubles, which are 64 bit in size). If you are unfamiliar with SIMD instructions, lab 9 can be a good warmup.</p>

<p>As a reminder, you can use the <a href="https://software.intel.com/sites/landingpage/IntrinsicsGuide/">Intel Intrinsics Guide</a> as a reference to look up the relevant instructions. You will have to use the <code class="language-plaintext highlighter-rouge">__m256d</code> type to hold 4 doubles in a YMM register, and then use the <code class="language-plaintext highlighter-rouge">_mm256_*</code> intrinsics to operate on them.</p>

<p>Here is a list of AVX instructions that you may find helpful, although you are also allowed to use other AVX instructions not on the list.</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">_mm256_storeu_pd</span> <span class="p">(</span><span class="kt">double</span> <span class="o">*</span> <span class="n">mem_addr</span><span class="p">,</span> <span class="n">__m256d</span> <span class="n">a</span><span class="p">)</span>
<span class="n">__m256d</span> <span class="n">_mm256_set1_pd</span> <span class="p">(</span><span class="kt">double</span> <span class="n">a</span><span class="p">)</span>
<span class="n">__m256d</span> <span class="n">_mm256_set_pd</span> <span class="p">(</span><span class="kt">double</span> <span class="n">e3</span><span class="p">,</span> <span class="kt">double</span> <span class="n">e2</span><span class="p">,</span> <span class="kt">double</span> <span class="n">e1</span><span class="p">,</span> <span class="kt">double</span> <span class="n">e0</span><span class="p">)</span>
<span class="n">__m256d</span> <span class="n">_mm256_loadu_pd</span> <span class="p">(</span><span class="kt">double</span> <span class="k">const</span> <span class="o">*</span> <span class="n">mem_addr</span><span class="p">)</span>
<span class="n">__m256d</span> <span class="n">_mm256_add_pd</span> <span class="p">(</span><span class="n">__m256d</span> <span class="n">a</span><span class="p">,</span> <span class="n">__m256d</span> <span class="n">b</span><span class="p">)</span>
<span class="n">__m256d</span> <span class="n">_mm256_sub_pd</span> <span class="p">(</span><span class="n">__m256d</span> <span class="n">a</span><span class="p">,</span> <span class="n">__m256d</span> <span class="n">b</span><span class="p">)</span>
<span class="n">__m256d</span> <span class="n">_mm256_fmadd_pd</span> <span class="p">(</span><span class="n">__m256d</span> <span class="n">a</span><span class="p">,</span> <span class="n">__m256d</span> <span class="n">b</span><span class="p">,</span> <span class="n">__m256d</span> <span class="n">c</span><span class="p">)</span>
<span class="n">__m256d</span> <span class="n">_mm256_mul_pd</span> <span class="p">(</span><span class="n">__m256d</span> <span class="n">a</span><span class="p">,</span> <span class="n">__m256d</span> <span class="n">b</span><span class="p">)</span>
<span class="n">__m256d</span> <span class="n">_mm256_cmp_pd</span> <span class="p">(</span><span class="n">__m256d</span> <span class="n">a</span><span class="p">,</span> <span class="n">__m256d</span> <span class="n">b</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">imm8</span><span class="p">)</span>
<span class="n">__m256d</span> <span class="n">_mm256_and_pd</span> <span class="p">(</span><span class="n">__m256d</span> <span class="n">a</span><span class="p">,</span> <span class="n">__m256d</span> <span class="n">b</span><span class="p">)</span>
<span class="n">__m256d</span> <span class="n">_mm256_max_pd</span> <span class="p">(</span><span class="n">__m256d</span> <span class="n">a</span><span class="p">,</span> <span class="n">__m256d</span> <span class="n">b</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="step-3-openmp">Step 3: OpenMP</h3>
<p>Finally you should use OpenMP to parallelize computation. Note that you will need to make sure that none of the different threads overwrites each others’ data. Just adding a <code class="language-plaintext highlighter-rouge">#pragma omp parallel for</code> may cause errors.</p>

<p>Note that the Hive machines have 4 cores with two hyperthreads each. This means that you should expect a speed-up of 4-8x (note that hyperthreads mean that two different threads execute on the same physical core at the same time; they will therefore compete for processor resources, and as a result, you will not get the same performance as if you were running on two completely separate cores).</p>

<h2 id="task-5-tell-us-what-you-did">Task 5: Tell us what you did!</h2>
<p>Write up what you did in your README.md! While we do not have a specific format we are looking for, you should discuss what you did as a whole, the different python functions you implemented, what performance improvements you had, what were you surprised about, etc. More specifically, we want you to document your <code class="language-plaintext highlighter-rouge">numc</code> module and provide example usages. <strong>We expect a minimum of 6000 characters.</strong> This may seem like a lot, but documenting you’ve done actually takes quite a number of words, so just sufficiently covering all the things you did in the project should get you to the word count requirement.
Again, failure to complete this task may result in negative points, so make sure you do it or you will lose points!</p>

<div id="unittest"></div>

<h2 id="testing-1">Testing</h2>
<p><strong>We will not be grading your tests but we will NOT help you debug unless you have written a test which shows how your code is failing. This means just using the autograder to figure out your issues will not be acceptable for office hours.</strong></p>

<p>We use <strong><code class="language-plaintext highlighter-rouge">unittest</code></strong> as the framework for testing and have provided a <code class="language-plaintext highlighter-rouge">unittests</code> folder that contains this framework for testing your python module. You should be familiar with <code class="language-plaintext highlighter-rouge">unittest</code> by now as you have had experience with it in project 2. <strong>Here is the official documentation for the standard <a href="https://docs.python.org/3.6/library/unittest.html">Python unittest library</a>.</strong>
<code class="language-plaintext highlighter-rouge">unittests/unittests.py</code> contains all the skeleton code for both correctness and performance tests, and <code class="language-plaintext highlighter-rouge">unittests/utils.py</code> has all the functions that you might need in order to write tests. We have provided some sample tests for you, but it is up to you to design and code up the tests. We will not be grading your tests.</p>

<p>As mentioned in <a href="index.html#tip">Tips and Guidelines</a> and <a href="index.html#getting-started">Getting Started</a>, we have installed the naive solution which we will be comparing against on hive! The python package is called <code class="language-plaintext highlighter-rouge">dumbpy</code> and you can import it like any other python library (so long as you are on hive)! Please note we will not be distributing this binary which means you must work on hive if you want to test with it. You should use this and the <strong><code class="language-plaintext highlighter-rouge">time</code></strong> package to determine how much you sped up your code.</p>

<h3 id="functions-in-unittestsutilspy">Functions in <code class="language-plaintext highlighter-rouge">unittests/utils.py</code></h3>
<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">dp_nc_matrix(*args, **kwargs)</code></strong>
    <ul>
      <li>This function will return a <code class="language-plaintext highlighter-rouge">dumbpy</code> matrix and a <code class="language-plaintext highlighter-rouge">numc</code> matrix that are identical. <code class="language-plaintext highlighter-rouge">*args</code> and <code class="language-plaintext highlighter-rouge">**kwargs</code> will be used as the arguments to instantiate both matrices in the exact same format as you would instantiate a <code class="language-plaintext highlighter-rouge">numc.Matrix</code>. We provide some examples below.
        <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">&gt;&gt;&gt;</span> <span class="n">dp_mat</span><span class="p">,</span> <span class="n">nc_mat</span> <span class="o">=</span> <span class="n">dp_nc_matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">dp_mat</span>
  <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">nc_mat</span>
  <span class="p">[[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]]</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">dp_mat</span><span class="p">,</span> <span class="n">nc_mat</span> <span class="o">=</span> <span class="n">dp_nc_matrix</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">dp_mat</span>
  <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]]</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">nc_mat</span>
  <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]]</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">rand_dp_nc_matrix(rows, cols, seed=0)</code></strong>
    <ul>
      <li>This function will instantiate a random <code class="language-plaintext highlighter-rouge">dumbpy</code> matrix and a random <code class="language-plaintext highlighter-rouge">numc</code> matrix with <code class="language-plaintext highlighter-rouge">seed</code>. The two matrices are identical with <code class="language-plaintext highlighter-rouge">rows</code> rows and <code class="language-plaintext highlighter-rouge">cols</code>. <code class="language-plaintext highlighter-rouge">seed</code> is defaulted to 0.
        <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="o">&gt;&gt;&gt;&gt;</span> <span class="n">dp_mat</span><span class="p">,</span> <span class="n">nc_mat</span> <span class="o">=</span> <span class="n">rand_dp_nc_matrix</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">dp_mat</span>
  <span class="p">[[</span><span class="mf">0.27474559623503386</span><span class="p">,</span> <span class="mf">0.046467764790387715</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.9927552244592249</span><span class="p">,</span> <span class="mf">0.08003044504673706</span><span class="p">]]</span>
  <span class="o">&gt;&gt;&gt;</span> <span class="n">nc_mat</span>
  <span class="p">[[</span><span class="mf">0.27474559623503386</span><span class="p">,</span> <span class="mf">0.046467764790387715</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.9927552244592249</span><span class="p">,</span> <span class="mf">0.08003044504673706</span><span class="p">]]</span>
</code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">cmp_dp_nc_matrix(dp_mat: dp.Matrix, nc_mat: nc.Matrix)</code></strong>
    <ul>
      <li>This function will return True if <code class="language-plaintext highlighter-rouge">dp_mat</code> has the same size of <code class="language-plaintext highlighter-rouge">nc_mat</code> and all corresponding elements are equal (within a margin of error).</li>
    </ul>
  </li>
  <li><strong><code class="language-plaintext highlighter-rouge">compute(dp_mat_lst: List[Union[dp.Matrix, int]],
  nc_mat_lst: List[Union[nc.Matrix, int]], op: str)</code></strong>
    <ul>
      <li>This function takes in a list of dumbpy matrices and a list of numc matrices, then applies the specified operation <code class="language-plaintext highlighter-rouge">op</code> on these matrices. Note that <code class="language-plaintext highlighter-rouge">op</code> is a string. <code class="language-plaintext highlighter-rouge">"add"</code>, <code class="language-plaintext highlighter-rouge">"sub"</code>, <code class="language-plaintext highlighter-rouge">"mul"</code>, <code class="language-plaintext highlighter-rouge">"neg"</code>, <code class="language-plaintext highlighter-rouge">"abs"</code>, and <code class="language-plaintext highlighter-rouge">"pow"</code> correspond to the operations <code class="language-plaintext highlighter-rouge">+</code>, <code class="language-plaintext highlighter-rouge">-</code>(subtraction), <code class="language-plaintext highlighter-rouge">*</code>, <code class="language-plaintext highlighter-rouge">-</code>(negation), and <code class="language-plaintext highlighter-rouge">abs</code>, respectively. This function will return whether the computed <code class="language-plaintext highlighter-rouge">dumbpy</code> matrix is equal to the computed <code class="language-plaintext highlighter-rouge">numc</code> matrix, as well as the speedup for this specific computation.
        <ul>
          <li>For unary operations like <code class="language-plaintext highlighter-rouge">"neg"</code> and <code class="language-plaintext highlighter-rouge">"abs"</code>, each matrix list must only contain 1 matrix. For the binary operations, they must contain more than 1 matrix.</li>
          <li>Note that to compute <code class="language-plaintext highlighter-rouge">"pow"</code>, <code class="language-plaintext highlighter-rouge">dp_mat_lst</code> and <code class="language-plaintext highlighter-rouge">nc_mat_lst</code> should look like something like <code class="language-plaintext highlighter-rouge">[Matrix(2, 2), 1]</code>.</li>
          <li>You can also do chained operations like <code class="language-plaintext highlighter-rouge">compute([a, b, c], [d, e, f], "add")</code> where <code class="language-plaintext highlighter-rouge">a, b, c, d, e, f</code> are matrices, and the function will compute <code class="language-plaintext highlighter-rouge">a + b + c</code> and <code class="language-plaintext highlighter-rouge">d + e + f</code>.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="more-about-unittest">More about <code class="language-plaintext highlighter-rouge">unittest</code></h3>
<ul>
  <li>Running
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>python <span class="nt">-m</span> unittest unittests.py <span class="nt">-v</span>
</code></pre></div>    </div>
    <p>will run all tests in <code class="language-plaintext highlighter-rouge">unittests.py</code>.</p>
  </li>
  <li>If you only want to run tests of one particular class, run
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>python <span class="nt">-m</span> unittest unittests.<span class="o">{</span>classname<span class="o">}</span> <span class="nt">-v</span>
</code></pre></div>    </div>
    <p>For example, running</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>python <span class="nt">-m</span> unittest unittests.TestAdd <span class="nt">-v</span>
</code></pre></div>    </div>
    <p>will only run the tests under the <code class="language-plaintext highlighter-rouge">TestAdd</code> class.</p>
  </li>
  <li>If you want to run a specific test under a specific class, run
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>python <span class="nt">-m</span> unittest unittests.<span class="o">{</span>classname<span class="o">}</span>.<span class="o">{</span>testname<span class="o">}</span> <span class="nt">-v</span>
</code></pre></div>    </div>
    <p>For example, running</p>
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span>python <span class="nt">-m</span> unittest unittests.TestAdd.test_small_add <span class="nt">-v</span>
</code></pre></div>    </div>
    <p>will only run the <code class="language-plaintext highlighter-rouge">test_small_add</code> test.</p>
  </li>
</ul>

<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<div id="faq"></div>

<h3 id="task-1">Task 1</h3>

<div id="1.1"></div>

<ul>
  <li><strong>Q 1.1</strong>: Will we be graded on what types of errors we threw? Or do we just have to throw some error?<br />
  <strong>A 1.1</strong>: Yes we expect you to throw the correct error types. We do not care about the error messages tho.<br /><br /></li>
</ul>

<div id="1.2"></div>

<ul>
  <li><strong>Q 1.2</strong>: I’m getting this when I run <code class="language-plaintext highlighter-rouge">make test</code>, what is happening?
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  rm -f test
  gcc -g -Wall -std=c99 -fopenmp -mavx -mfma -pthread -O3 mat_test.c matrix.c -o test -fopenmp -L/home/ff/cs61c/cunit/install/lib -I/home/ff/cs61c/cunit/install/include -lcunit -I/usr/include/python3.6 -lpython3.6m
  ./test
       CUnit - A unit testing framework for C - Version 2.1-2
       http://cunit.sourceforge.net/
  Makefile:25: recipe for target 'test' failed
  make: *** [test] Illegal instruction (core dumped)
</code></pre></div>    </div>
    <p><strong>A 1.2</strong>: This means your code segfaulted before any assert statements was reached and none of the tests passed. Use gdb to locate your bug.<br /><br /></p>
  </li>
</ul>

<div id="1.3"></div>

<ul>
  <li><strong>Q 1.3</strong>: Do we assume rows and cols start at 1 or 0?<br />
  <strong>A 1.3</strong>: They are both zero-indexed.<br /><br /></li>
  <li><strong>Q 1.4</strong>: Do our functions need to support self-referential operations? For example, <code class="language-plaintext highlighter-rouge">mul_matrix(mat, mat, mat)</code>.<br />
  <strong>A 1.4</strong>: No.<br /><br /></li>
  <li><strong>Q 1.5</strong>: Is it reasonable to run valgrind on <code class="language-plaintext highlighter-rouge">./test</code>?
  <strong>A 1.5</strong>: You can try, but would not recommend. Setting up valgrind for C-Python interface can be difficult.<br /><br /></li>
  <li><strong>Q 1.6</strong>: When we throw an error, is it just a fprintf call to stderr?<br />
  <strong>A 1.6</strong>: Nope, you should throw errors in a python context. i.e., when your python code calls this underlying C function, it should error. Take a look at the Python/C API’s reference manual for <a href="https://docs.python.org/3.6/c-api/exceptions.html">exception handling</a>.<br /><br /></li>
  <li><strong>Q 1.7</strong>: Can we make a slice on slice? for example, <code class="language-plaintext highlighter-rouge">mat1 = [[1,2,3],[4,5,6]]</code>, <code class="language-plaintext highlighter-rouge">mat2 = mat1[0]</code>. Can we do <code class="language-plaintext highlighter-rouge">mat3 = mat2[0]</code>?<br />
  <strong>A 1.7</strong>: You can make a slice on a 2D slice, but a “slice” on a 1D slice is just a number and is pass by value. In this case, <code class="language-plaintext highlighter-rouge">mat3</code> will just be a number and changing its value will not change <code class="language-plaintext highlighter-rouge">mat2</code>.<br /><br /></li>
  <li><strong>Q 1.8</strong>: Does our solution need to exactly match the reference?<br />
  <strong>A 1.8</strong>: No, we allow an error margin of 1e-6.<br /><br /></li>
</ul>

<h3 id="task-2">Task 2</h3>
<ul>
  <li><strong>Q 2.1</strong>: I’m getting undefined symbols upon import (for example, <code class="language-plaintext highlighter-rouge">undefined symbol: allocate_matrix_ref</code>). What is happening?<br />
  <strong>A 2.1</strong>: Think about what files your module needs, especially where the undefined symbol is located.<br /><br /></li>
  <li><strong>Q 2.2</strong>: The values in my matrices change after I print their slices.<br />
  <strong>A 2.2</strong>: This is likely a memory leak. Double check your <code class="language-plaintext highlighter-rouge">deallocate_matrix</code> implementation. What happens when you call <code class="language-plaintext highlighter-rouge">print(mat[0])</code> is that it will create a slice, then immediately deallocate it after this line.<br /><br /></li>
</ul>

<h3 id="task-3">Task 3</h3>
<ul>
  <li><strong>Q 3.1</strong>: Getting <code class="language-plaintext highlighter-rouge">&lt;class 'AttributeError'&gt; -- shape</code>.<br />
  <strong>A 3.1</strong>: Make sure the relevant method in numc.c is setting <code class="language-plaintext highlighter-rouge">mat-&gt;shape</code><br /><br /></li>
  <li><strong>Q 3.2</strong>: Getting <code class="language-plaintext highlighter-rouge">&lt;class 'SystemError'&gt; -- &lt;built-in method set of numc.Matrix object at 0x7f175faffef0&gt; returned NULL without setting an error!</code><br />
  <strong>A 3.2</strong>: You need to throw an error before returning <code class="language-plaintext highlighter-rouge">NULL</code> in any interface function.<br /><br /></li>
  <li><strong>Q 3.3</strong>: <code class="language-plaintext highlighter-rouge">UnicodeDecodeError: ‘utf-8’ codec can't decode byte 0x89 in position 5: invalid start byte</code> upon import. What’s wrong?<br />
  <strong>A 3.3</strong>: <code class="language-plaintext highlighter-rouge">{NULL, NULL, 0, NULL}</code> from starter code must be last element of <code class="language-plaintext highlighter-rouge">Matrix61c_methods</code>, so make sure you don’t accidentally remove that!<br /><br /></li>
  <li><strong>Q 3.4</strong>: Are we allowed to call methods we wrote in <strong><code class="language-plaintext highlighter-rouge">matrix.c</code></strong>?<br />
  <strong>A 3.4</strong>: Yes please do!<br /><br /></li>
  <li><strong>Q 3.5</strong>: How do we know what gets passed into <code class="language-plaintext highlighter-rouge">PyObject* args</code>?<br />
  <strong>A 3.5</strong>: Read the <a href="https://docs.python.org/3.6/c-api/">official documentation</a>! (You can also take a look at the starter code for examples.)<br /><br /></li>
</ul>

<h3 id="task-4">Task 4</h3>
<ul>
  <li><strong>Q 4.1</strong>: <code class="language-plaintext highlighter-rouge">#pragma omp parallel for</code> above a simple for loop slows down my add_matrix drastically?<br />
  <strong>A 4.1</strong>: You need big matrices to actually see the effect of speedup (something around 1000 * 1000).<br /><br /></li>
  <li><strong>Q 4.2</strong>: I’m getting <code class="language-plaintext highlighter-rouge">warning: ignoring #pragma omp parallel [-Wunknown-pragmas]</code> but I have not changed the Makefile?<br />
  <strong>A 4.2</strong>: It might be your task 2. Take a look at the compiler and linker flags we provided you.<br /><br /></li>
</ul>

<h3 id="autograder-related-questions">Autograder-related Questions</h3>
<ul>
  <li><strong>Q 5.1</strong>: I’m passing my local correctness tests but failing autograder. What might be the case?<br />
  <strong>A 5.1</strong>: Here are some common sources of bugs. 1. Make sure you test your matrix operations on non-integer floating point values (such as 1.2, 1.3). In the past semester, some students’ code was only able to generate correct results when every floating point value in their matrices were integer-valued floating points (such as 1.0, 2.0). 2. Make sure you are setting the <code class="language-plaintext highlighter-rouge">shape</code> attribute of every returned matrix! 3. Please do NOT modify anything related to generating random matrices! Do NOT try to speed them up! We use those to generate matrices to test on the autograder. We don’t include the time for generating matrices when testing for performance.<br /><br /></li>
  <li><strong>Q 5.2</strong>: Performance tests are failing but correctness tests all pass.<br />
  <strong>A 5.2</strong>: Our performance tests test on much larger matrices than the correctness tests, so make sure you handle those cases correctly!<br /><br /></li>
  <li><strong>Q 5.3</strong>: Failing tests that are related to throwing errors.<br />
  <strong>A 5.3</strong>: Make sure you are throwing the correct type of error, not just any error.<br /><br /></li>
</ul>

<div id="grading"></div>

<h2 id="grading">Grading</h2>
<p>The grading breakdown for Project 4 is as follows:</p>
<ul>
  <li>Correctness: 55%</li>
  <li>Speedup: 40%
    <ul>
      <li>Multiplication: 20%</li>
      <li>Power: 25%</li>
      <li>Simple: 12.5%</li>
      <li>Comprehensive: 42.5%</li>
    </ul>
  </li>
  <li>README.md: 5%</li>
</ul>

<p>Here are the graphs for the speedup tests. The x-axis is your speedup times and the y-axis indicates what percentage of that test’s total score you will receive.</p>

<div class="grading-graphs">

  <table>
    <thead>
      <tr>
        <th style="text-align: center">Multiplication</th>
        <th style="text-align: center">Power</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="text-align: center"><img src="speedup_images/mul.png" alt="mul.png" /></td>
        <td style="text-align: center"><img src="speedup_images/pow.png" alt="pow.png" /></td>
      </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th style="text-align: center">Simple</th>
        <th style="text-align: center">Comprehensive</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="text-align: center"><img src="speedup_images/simple.png" alt="simple.png" /></td>
        <td style="text-align: center"><img src="speedup_images/comprehensive.png" alt="comprehensive.png" /></td>
      </tr>
    </tbody>
  </table>

</div>

<p>Minimum speedup for 100% on each test:</p>
<ul>
  <li>Multiplication: 95x</li>
  <li>Power: 1700x</li>
  <li>Simple: 4.9x</li>
  <li>Comprehensive: 98x</li>
</ul>

<p>Since we are running your submissions on hive, albeit reserved, speedup times may fluctuate a bit. You should try to go above the speedup value as we will rerun the ag after the deadline and your speedup may go up or down. We will not rerun submissions if they went down unless we made another change to the autograder.</p>

<p>We will only be using your <code class="language-plaintext highlighter-rouge">matrix.h</code>, <code class="language-plaintext highlighter-rouge">matrix.c</code>, <code class="language-plaintext highlighter-rouge">numc.c</code>, <code class="language-plaintext highlighter-rouge">setup.py</code>, and <code class="language-plaintext highlighter-rouge">README.md</code> for grading. Gradescope only shows you all the core correctness tests that are needed to run performance tests. Other tests will stay hidden until the late due date.</p>

<h2 id="performance-contest">Performance Contest</h2>
<p>We are doing a performance contest for Project 4 this year! The method in which your Project 4 submission will be scored is based on the performance on your <code class="language-plaintext highlighter-rouge">numc</code> module. <strong>Note that while all submitted designs will show a score, only submissions that pass 100% of visible and hidden tests will be eligible for the contest.</strong> This means that it is in your best interest to test throughly!</p>

<p>We are still determining which benchmark(s) will be used in evaluating your solution and will update the spec once we have finalized that.</p>


        </div>
        <div class="col-sm-3">
            <nav id="toc" class="sticky-top" style="top: 40px;"></nav>
        </div>
    </div>
    
    <script>
        $(function() {
            var navSelector = "#toc";
            var $myNav = $(navSelector);
            Toc.init($myNav);
            $("body").scrollspy({
                target: navSelector
            });
        });
    </script>


          </div>
    </div>

    <footer class="page-footer">
        <ul class="nav justify-content-center">
            <li class="nav-item">
                <a class="nav-link text-secondary" href="http://cs61c.org/fa20">
                  CS 61C
                </a>
              </li>
            
            
              

<li class="nav-item">
    <a class="nav-link "  href="http://cs61c.org/fa20/calendar" >
      Calendar
    </a>
  </li>

            
              

<li class="nav-item">
    <a class="nav-link "  href="http://cs61c.org/fa20/staff" >
      Staff
    </a>
  </li>

            
              

<li class="nav-item">
    <a class="nav-link "  href="http://cs61c.org/fa20/policies" >
      Policies
    </a>
  </li>

            
              

<li class="nav-item">
    <a class="nav-link  text-dark "  href="https://piazza.com/" >
      Piazza
    </a>
  </li>

            
              

<li class="nav-item">
    <a class="nav-link  text-dark "  href="https://oh.cs61c.org" >
      OH Queue
    </a>
  </li>

            
            
              

<li class="nav-item">
    <a class="nav-link  text-dark "  href="https://venus.cs61c.org/" >
      Venus
    </a>
  </li>

            
              

<li class="nav-item">
    <a class="nav-link "  href="http://cs61c.org/resources/" >
      Resources
    </a>
  </li>

            
              

<li class="nav-item">
    <a class="nav-link "  href="http://cs61c.org/?redirect=false" >
      Semesters
    </a>
  </li>

            

            <li class="nav-item">
              <a class="nav-link text-secondary" href="index.html#">
                Back to top
              </a>
            </li>
        </ul>
    </footer>

    <script type="text/javascript" src="http://cs61c.org/assets/theme/theme.js"></script>
  </body>
</html>
