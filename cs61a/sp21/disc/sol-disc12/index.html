
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="description" content ="CS 61A: Structure and Interpretation of Computer Programs" />
    <meta name="keywords" content ="CS 61A, Computer Science, CS, 61A, Programming, John DeNero, Berkeley, EECS" />
    <meta name="author" content ="Pamela Fox, Paul Hilfinger" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-throttle-debounce/1.1/jquery.ba-throttle-debounce.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="../../assets/js/hl.js"></script>
    <script>
        // we aren't registering builtins since
        //      (1) they don't render differently in the current CSS from other names
        //      (2) it's a mess to list all of them. You can extract from the site but that takes effort
        // if (1) ceases to be true, (2) might be worth the effort. For now, we're leaving as is
        hljsRegister({
            'keyword': "define if cond and or let begin lambda mu quote delay cons-stream set! quasiquote unquote unquote-splicing define-macro"
        });
        hljs.initHighlightingOnLoad();
    </script>
    <script src="../../assets/js/dark-mode.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata|Roboto:300,400,500|Work+Sans:400,700">
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="../../assets/css/mono-blue.css">
    <link rel="icon" href="../../assets/images/favicon.ico">

    

<link rel="stylesheet" type="text/css" href="../../assets/css/disc.css">


    <title>
Discussion 12 | CS 61A Spring 2021
</title>
  </head>

  <body id="index" class="home">
    <nav class="navbar navbar-default navbar-static-top">
      <div class="container noselect">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-section">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">
            <img style="max-width:60px; margin-top: -20px;" class="logo" src="../../assets/images/logo.png"/>
          </a>
        </div>

        <div class="collapse navbar-collapse" id="navbar-collapse-section">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="../../weekly/index.html">Weekly Schedule</a></li>
            <li><a href="../../office-hours/index.html">Office Hours</a></li>
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="index.html#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Staff
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                <li><a href="../../instructor/index.html">Instructors</a></li>
                <li><a href="../../TAs/index.html">TAs</a></li>
                <li><a href="../../tutors/index.html">Tutors</a></li>
                <li><a href="../../academic-interns/index.html">Academic Interns</a></li>
              </ul>
            </li>
            <li><a href="../../resources/index.html">Resources</a></li>
            <li><a href="../../articles/about/index.html">Syllabus</a></li>
            <li><a href="https://piazza.com/berkeley/spring2021/cs61a" target="_blank">Piazza</a></li>
            <li><a href="https://code.cs61a.org">Code</a></li>
            <li><a href="http://tutor.cs61a.org">PyTutor</a></li>
            <li><a href="../../contact/index.html">Contact</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <main id="content" class="container">
      
<div class='row'>
  <div class='col-md-9'>
    <header>
      <h1>
        
Discussion 12: Tail Recursion, Macros

        
        
        <ul class="inline-block list-inline">
          <li><a href="javascript:window.print()" class="label label-outline">disc12.pdf</a></li>
        </ul>
        
        
      </h1>
    </header>
    

<div class="alert storable-login-status"></div>

This is an online worksheet that you can work on during discussions and tutorials.
Your work is not graded and you do not need to submit anything.

    



<h1 id="discussion-12-vitamin">Discussion 12 Vitamin</h1>


<p>To encourage everyone to watch or attend discussion orientation, we have created small discussion vitamins. Each vitamin you complete will give you an extra credit point towards the course. Please answer all of the questions in <a href="https://links.cs61a.org/vitamin-for-disc12">this form</a> by <strong>Thursday at 11:59 PM</strong>.</p>


<h1 id="tail-recursion">Tail Recursion</h1>


<p>When writing a recursive procedure, it's possible to write
it in a <strong>tail recursive</strong> way, where all of the recursive calls are tail calls.
A <strong>tail call</strong> occurs when a function calls another function as the last action of the
current frame.</p>

<p>Consider this implementation of <code>factorial</code> that is <em>not</em> tail recursive:</p>

<pre><code class="scheme">(define (factorial n)
  (if (= n 0)
      1
      (* n (factorial (&#x2d; n 1)))))</code></pre>



<p>The recursive call occurs in the last line, but it is not the last expression
evaluated. After calling <code>(factorial (&#x2d; n 1))</code>, the function still needs to
multiply that result with <code>n</code>. The final expression that is evaluated is
a call to the multiplication function, not <code>factorial</code> itself.  Therefore,
the recursive call is <code>not</code> a tail call.</p>

<p>Here's a visualization of the recursive process for computing <code>(factorial 6)</code> :</p>

<pre><code class="scheme">(factorial 6)
(* 6 (factorial 5))
(* 6 (* 5 (factorial 4)))
(* 6 (* 5 (* 4 (factorial 3))))
(* 6 (* 5 (* 4 (* 3 (factorial 2)))))
(* 6 (* 5 (* 4 (* 3 (* 2 (factorial 1))))))
(* 6 (* 5 (* 4 (* 3 (* 2 1)))))
(* 6 (* 5 (* 4 (* 3 2))))
(* 6 (* 5 (* 4 6)))
(* 6 (* 5 24))
(* 6 120)
720</code></pre>



<p>The interpreter first must reach the base case and only then can it begin
to calculate the products in each of the earlier frames.</p>

<p>We can rewrite this function using a helper function that remembers the
temporary product that we have calculated so far in each recursive step.</p>

<pre><code class="scheme">(define (factorial n)
  (define (fact&#x2d;tail n result)
    (if (= n 0)
        result
        (fact&#x2d;tail (&#x2d; n 1) (* n result))))
  (fact&#x2d;tail n 1))</code></pre>



<p><code>fact&#x2d;tail</code> makes a single recursive call to <code>fact&#x2d;tail</code>, and
that recursive call is the last expression to be evaluated, so it is a tail
call. Therefore, <code>fact&#x2d;tail</code> is a tail recursive process.</p>

<p>Here's a visualization of the tail recursive process for computing <code>(factorial 6)</code>:</p>

<pre><code class="scheme">(factorial 6)
(fact&#x2d;tail 6 1)
(fact&#x2d;tail 5 6)
(fact&#x2d;tail 4 30)
(fact&#x2d;tail 3 120)
(fact&#x2d;tail 2 360)
(fact&#x2d;tail 1 720)
(fact&#x2d;tail 0 720)
720</code></pre>



<p>The interpreter needed less steps to come up with the result, and it didn't need
to re-visit the earlier frames to come up with the final product.</p>


<h2 id="tail-call-optimization">Tail Call Optimization</h2>


<p>When a recursive procedure is not written in a tail recursive way,
the interpreter must have enough memory to store all of the previous recursive calls.</p>

<p>For example, a call to the <code>(factorial 3)</code> in the non tail-recursive version
must keep the frames for all the numbers from 3 down to the base case,
until it's finally able to calculate the intermediate products and forget those frames:</p>

<p><img class="img-responsive center-block" src="assets/factorial_stack.svg" alt="Example Tree"></p>

<p>For non tail-recursive procedures, the number of active frames grows proportionally to the number
of recursive calls. That may be fine for small inputs, but imagine calling <code>factorial</code>
on a large number like 10000. The interpreter would need enough memory for all 1000 calls!</p>

<p>Fortunately, proper Scheme interpreters implement <strong>tail-call optimization</strong>
as a requirement of the language specification. TCO ensures that tail recursive
procedures can execute with a constant number of active frames, so programmers
can call them on large inputs without fear of exceeding the available memory.</p>

<p>When the tail recursive <code>factorial</code> is run in an interpreter with tail-call optimization,
the interpreter knows that it does not need to keep the previous frames around,
so it never needs to store the whole stack of frames in memory:</p>

<p><img class="img-responsive center-block" src="assets/factorial_optimized.svg" alt="Example Tree"></p>

<p>Tail-call optimization can be implemented in a few ways:</p>

<ol>
  <li>Instead of creating a new frame, the interpreter can just update
  the values of the relevant variables in the current frame (like <code>n</code> and <code>result</code>
  for the <code>fact&#x2d;tail</code> procedure). It reuses the same frame for the
  entire calculation, constantly changing the bindings to match the next set of parameters.</li>
  <li>How our 61A Scheme interpreter works: The interpreter builds a new frame as usual,
  but then <em>replaces</em> the current frame with the new one.  The old frame is still around,
  but the interpreter no longer has any way to get to it.  When that happens, the Python
  interpreter does something clever: it <em>recycles</em> the old frame so that the next time
  a new frame is needed, the system simply allocates it out of recycled space.
  The technical term is that the old frame becomes "garbage", which the system
  "garbage collects" behind the programmer's back.</li>
</ol>


<h2 id="tail-context">Tail Context</h2>


<p>When trying to identify whether a given function call within the body of a
function is a tail call, we look for whether the call expression is in
<strong>tail context</strong>.</p>

<p>Given that each of the following expressions is the last expression in
the body of the function, the following expressions are tail contexts:</p>

<ol>
  <li>the second or third operand in an <code>if</code> expression</li>
  <li>any of the non-predicate sub-expressions in a <code>cond</code> expression
  (i.e. the second expression of each clause)</li>
  <li>the last operand in an <code>and</code> or an <code>or</code> expression</li>
  <li>the last operand in a <code>begin</code> expression's body</li>
  <li>the last operand in a <code>let</code> expression's body</li>
</ol>

<p>For example, in the expression <code>(begin (+ 2 3) (&#x2d; 2 3) (* 2 3))</code>,
<code>(* 2 3)</code> is a tail call because it is the last operand expression to be
evaluated.</p>

<!--\videowalkthrough{tail-recursion-intro}-->

<div class="page-break"></div>


<h2 id="questions">Questions</h2>


<h3 class="question" id="q1">Q1: Is Tail Call</h3>
For each of the following procedures, identify whether it contains a recursive
call in a tail context. Also indicate if it uses a constant number of active frames.

<pre><code class="scheme">(define (question&#x2d;a x)
  (if (= x 0) 0
      (+ x (question&#x2d;a (&#x2d; x 1)))))</code></pre>



            <label class="sr-only" for="tail-call-1-input">Your Answer:</label>
            <input class="form-control storable" id="tail-call-1-input" type="text">
            <div class="storable-status"></div>
        

<div class="sol-highlight">
In the recursive case, the last expression that is evaluated is a call to
<code>+</code>. Therefore, the recursive call is not in tail context, and each of
the frames remain active.
This procedure uses a number of active frames proportional to the input <code>x</code>.
</div>

<pre><code class="scheme">(define (question&#x2d;b x y)
  (if (= x 0) y
      (question&#x2d;b (&#x2d; x 1) (+ y x))))</code></pre>




            <label class="sr-only" for="tail-call-2-input">Your Answer:</label>
            <input class="form-control storable" id="tail-call-2-input" type="text">
            <div class="storable-status"></div>
        

<div class="sol-highlight">
The recursive call is the third operand in the if expression, so it is in tail
context. This means that the last expression that will be evaluated in the body
of this procedure is the recursive procedure call, so this procedure can
be run with a constant number of active frames.
</div>

<pre><code class="scheme">(define (question&#x2d;c x y)
  (if (&gt; x y)
      (question&#x2d;c (&#x2d; y 1) x)
      (question&#x2d;c (+ x 10) y)))</code></pre>




            <label class="sr-only" for="tail-call-3-input">Your Answer:</label>
            <input class="form-control storable" id="tail-call-3-input" type="text">
            <div class="storable-status"></div>
        

<div class="sol-highlight">
The recursive calls are the second and third operands of the <code>if</code>
expression. Only one of these calls is actually evaluated, and whichever one it
is will be the last expression evaluated in the body of the procedure.
This procedure therefore can be run with a constant number of active frames.

<p>Note that if you actually try and evaluate this procedure, it will never
terminate. But at least it won't crash from hitting max recursion depth!
</div></p>

<pre><code class="scheme">(define (question&#x2d;d n)
  (if (question&#x2d;d n)
      (question&#x2d;d (&#x2d; n 1))
      (question&#x2d;d (+ n 10))))</code></pre>




            <label class="sr-only" for="tail-call-4-input">Your Answer:</label>
            <input class="form-control storable" id="tail-call-4-input" type="text">
            <div class="storable-status"></div>
        

<div class="sol-highlight">
The second and third recursive calls are in tail context, but the first is not.
Since not all the recursive calls are tail calls, this procedure
requires active frames for all of the recursive calls.

<p>Additionally, this question will actually lead to infinite recursion because the if condition will never reach a base case!
</div></p>

<!--\videowalkthrough{tail-recursion-is-tail-call}-->

<pre><code class="scheme">(define (question&#x2d;e n)
  (cond ((&lt;= n 1) 1)
        ((question&#x2d;e (&#x2d; n 1)) (question&#x2d;e (&#x2d; n 2)))
        (else (begin (print 2) (question&#x2d;e (&#x2d; n 3))))))</code></pre>




            <label class="sr-only" for="tail-call-5-input">Your Answer:</label>
            <input class="form-control storable" id="tail-call-5-input" type="text">
            <div class="storable-status"></div>
        

<div class="sol-highlight">
The second and third recursive calls are the second expressions in a clause, so
they are in tail context. However, the first recursive call is not in tail
context. Since not all recursive calls are tail calls, this procedure is not
tail recursive and does not use a constant number of active frames.
</div>

<h3 class="question" id="q2">Q2: Sum</h3>
Write a tail recursive function that takes in a Scheme list and returns
the numerical sum of all values in the list. You can assume that the list
contains only numbers (no nested lists).


            
            <b>Your Answer</b>
            
            <div class="monaco-storable" id="sum-input" style="height:342px;"></div>
            <a href="index.html#" data-toggle="modal" data-target="#modal-sum-input">Run in 61A Code</a>
            <div class="modal fade" id="modal-sum-input" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content" style="padding-bottom: -5px">
                    <iframe
                        id="code-iframe-sum-input"
                        width="100%"
                        height="700px"
                        style="border: none; display:block;"
                    ></iframe>
                    </div>
                </div>
            </div>
            <div class="storable-status"></div>
            <script>
                $(() => activateEditor("(define (sum lst)\n  'YOUR-CODE-HERE\n)\n\n'YOUR-CODE-HERE\n\n", "scheme", "sum-input"));
            </script>
        
            <div class="sol-highlight">
                <b>Solution</b>
                
<pre><code>(define (sum lst)
<div class="sol-highlight">  (define (sum&#x2d;sofar lst current&#x2d;sum)
    (if (null? lst)
        current&#x2d;sum
        (sum&#x2d;sofar (cdr lst) (+ (car lst) current&#x2d;sum))))
  (sum&#x2d;sofar lst 0)</div>)

<div class="sol-highlight">; ALTERNATE SOLUTION
(define (sum lst)
    (cond 
      ((null? lst) 0)
      ((null? (cdr lst)) (car lst))
      (else (sum (cons (+ (car lst) (car (cdr lst))) (cdr (cdr lst)))))
    )
)</div></code></pre>

            </div>
        

<pre><code class="scheme">scm&gt; (sum &#x27;(1 2 3))
6
scm&gt; (sum &#x27;(10 &#x2d;3 4))
11</code></pre>



<div class="sol-highlight">
<a href="https://youtu.be/9y7rnuYp-DU?t=9m27s">Video walkthrough</a>
</div>

<h3 class="question" id="q3">Q3: (Tutorial) Reverse</h3>

<p>Write a tail-recursive function <code>reverse</code> that takes in a Scheme list a
returns a reversed copy. <em>Hint</em>: use a helper function!</p>


            
            <b>Your Answer</b>
            
            <div class="monaco-storable" id="reverse-input" style="height:162px;"></div>
            <a href="index.html#" data-toggle="modal" data-target="#modal-reverse-input">Run in 61A Code</a>
            <div class="modal fade" id="modal-reverse-input" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content" style="padding-bottom: -5px">
                    <iframe
                        id="code-iframe-reverse-input"
                        width="100%"
                        height="700px"
                        style="border: none; display:block;"
                    ></iframe>
                    </div>
                </div>
            </div>
            <div class="storable-status"></div>
            <script>
                $(() => activateEditor("(define (reverse lst)\n  'YOUR-CODE-HERE\n)\n", "scheme", "reverse-input"));
            </script>
        
            <div class="sol-highlight">
                <b>Solution</b>
                
<pre><code>(define (reverse lst)
<div class="sol-highlight">  (define (reverse&#x2d;tail sofar rest)
    (if (null? rest)
          sofar
          (reverse&#x2d;tail (cons (car rest) sofar) (cdr rest))))
  (reverse&#x2d;tail nil lst)</div>)</code></pre>

            </div>
        

<pre><code class="scheme">scm&gt; (reverse &#x27;(1 2 3))
(3 2 1)
scm&gt; (reverse &#x27;(0 9 1 2))
(2 1 9 0)</code></pre>



<div class="page-break"></div>


<h1 id="python-macros">Python "Macros"</h1>


<p>Imagine if we wanted to write a function in Python that
would create and evaluate the following line of code:</p>

<pre><code>[&lt;expr&gt; for i in range(5)]</code></pre>



<p>Where we could pass in any arbitrary expression <code>&lt;expr&gt;</code>,
that would then be evaluated 5 times and have the results listed.
This is the kind of problem that macros were made for!</p>

<p>A macro is a procedure that operates on unevaluated code. In
the example above, <code>&lt;expr&gt;</code> is not necessarily an object, but
could be any piece of code, such as <code>print(&quot;Hello&quot;)</code>, <code>[j ** 2 for j in range(i)]</code>,
or <code>i &gt;= 5</code>. For these expressions it is important to our problem
statement that they not be evaluated until <em>after</em> they have been inserted into
our list comprehension, either because they have side effects that will be apparent
in the global frame, or because they depend on <code>i</code> in some way (there can be
other reasons too!). So, we need a procedure that, instead of manipulating objects,
manipulates code itself. This is where macros come in.</p>

<p>Unfortunately for us, Python does not have the ability to make true macros. Let's see
what happens if we try to solve this problem with a traditional function.</p>

<pre><code>def list_5(expr):
	return [expr for i  in range(5)]

&gt;&gt;&gt; lst = list_5(print(10))
10
&gt;&gt;&gt; lst
[None, None, None, None, None]</code></pre>



<p>This isn't quite what we want. Because of Python evaluation rules,
instead of evaluating a list of 5 <code>print(10)</code> statements, our <code>expr</code>
was evaluated before the function was ever called, meaning 10 was
only printed once.</p>

<p>The issue here is order of evaluation---we don't want our expression
parameter to be evaluated until <em>after</em> it is inserted into our list
comprehension. Even though we don't have the ability to make real macros when
writing Python, we can write a function in the spirit of macros by returning a <strong>string</strong> representing the return expression, and <strong>evaluating</strong> this string after it has been returned.</p>

<pre><code>def list_5(expr):
	return f&quot;[{expr} for i  in range(5)]&quot;

&gt;&gt;&gt; lst = eval(list_5(&quot;print(10)&quot;))
10
10
10
10
10
&gt;&gt;&gt; lst
[None, None, None, None, None]</code></pre>



<p>Now we see the number 10 printed 5 times as a side effect of our function, just
like we want! We circumvented Python's evaluate-operands-before-evaluating-function
body rule by passing in our desired expression as a string. Then, after we constructed
our list comprehension in string form and we've returned it, we used the <code>eval</code> function to force evaluation
of the output after the last step in the execution of this
function. We were able to write code that took
code as a parameter and restructured it in the form of new code!</p>

<p>Although this is a cool hack we can do with Python, its usage is unfortunately rather limited.
The <code>eval</code> function will throw a <code>SyntaxError</code> if it is
passed any <code></code>compound'' blocks such as <code>if: ...</code>, <code>while: ...</code>,
<code>for: ...</code>, etc. (this does not include list comprehensions, or one-line if-statements
such as <code>1 if  a &gt; b else 0</code>.)</p>

<h3 class="question" id="q4">Q4: Make Lambda Python</h3>
Write a "macro" in Python called <code>make_lambda</code> that takes in
two parameters: <code>params</code>, a <strong>string</strong> containing a comma-separated list of
variable names; and <code>body</code>, a Python expression in <strong>string</strong> form, and <strong>returns
a string</strong> that, when evaluated, will return a lambda function that takes <code>params</code> as its parameters and <code>body</code>
as its body.

<p>A string with an <code>f</code> (which is called an <strong>f-String</strong>) is like a quasiquoted
expression in Scheme, and anything in that string in braces will be treated as though
it has been unquoted. Try to write <code>make_lambda</code> using this syntax!</p>

<p>For an example of f-Strings, the following two pieces of code are equivalent:</p>

<pre><code>&gt;&gt;&gt; x = 2
&gt;&gt;&gt; &quot;The value of x is: &quot; + x
&#x27;The value of x is 2&#x27;
&gt;&gt;&gt; f&quot;The value of x is {x}&quot;
&#x27;The value of x is 2&#x27;</code></pre>



<p><strong>Hint:</strong> Try constructing the string that would define the lambda, and return that.</p>


            
            <b>Your Answer</b>
            
            <div class="monaco-storable" id="make-lambda-python-input" style="height:306px;"></div>
            <a href="index.html#" data-toggle="modal" data-target="#modal-make-lambda-python-input">Run in 61A Code</a>
            <div class="modal fade" id="modal-make-lambda-python-input" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content" style="padding-bottom: -5px">
                    <iframe
                        id="code-iframe-make-lambda-python-input"
                        width="100%"
                        height="700px"
                        style="border: none; display:block;"
                    ></iframe>
                    </div>
                </div>
            </div>
            <div class="storable-status"></div>
            <script>
                $(() => activateEditor('def make_lambda(params, body):\n    &quot;&quot;&quot;\n    &gt;&gt;&gt; f = eval(make_lambda(&quot;x, y&quot;, &quot;x + y&quot;))\n    &gt;&gt;&gt; f\n    &lt;function &lt;lambda&gt;&gt;\n    &gt;&gt;&gt; f(1, 2)\n    3\n    &gt;&gt;&gt; g = eval(make_lambda(&quot;a, b, c&quot;, &quot;c if a &gt; b else &#x2d;c&quot;))\n    &gt;&gt;&gt; g(1, 2, 3)\n    &#x2d;3\n    &gt;&gt;&gt; eval(make_lambda(&quot;f, x, y&quot;, &quot;f(x, y)&quot;))(f, 1, 2)\n    3\n    &quot;&quot;&quot;\n    "*** YOUR CODE HERE ***"\n\n', "scheme", "make-lambda-python-input"));
            </script>
        
            <div class="sol-highlight">
                <b>Solution</b>
                
<pre><code>def make_lambda(params, body):
    &quot;&quot;&quot;
    &gt;&gt;&gt; f = eval(make_lambda(&quot;x, y&quot;, &quot;x + y&quot;))
    &gt;&gt;&gt; f
    &lt;function &lt;lambda&gt;&gt;
    &gt;&gt;&gt; f(1, 2)
    3
    &gt;&gt;&gt; g = eval(make_lambda(&quot;a, b, c&quot;, &quot;c if a &gt; b else &#x2d;c&quot;))
    &gt;&gt;&gt; g(1, 2, 3)
    &#x2d;3
    &gt;&gt;&gt; eval(make_lambda(&quot;f, x, y&quot;, &quot;f(x, y)&quot;))(f, 1, 2)
    3
    &quot;&quot;&quot;
<div class="sol-highlight">    return f&quot;lambda {params}: {body}&quot;</div></code></pre>

            </div>
        
<h3 class="question" id="q5">Q5: (Tutorial) If Macro Python</h3>

<p>In <a href="../../hw/hw01/index.html#q5">Homework 1</a> you implemented an "If function" that functioned differently from an if statement. It was different because it did not short circuit in evaluating its operands! In this problem, we will write a "macro" in Python called <code>if_macro</code> that takes in three arguments:</p>

<ol>
  <li><code>condition</code>: a string that will evaluate to a truth-y or false-y value</li>
  <li><code>true_result</code>: a string that will be evaluated and returned if <code>condition</code> is truth-y</li>
  <li><code>false_result</code>: a string that will be evaluated and returned if <code>condition</code> is false-y.</li>
</ol>

<p>and returns a <strong>string</strong> that, when evaluated, will return the result of this if function.</p>

<p><code>if_macro</code> should <strong>only</strong> evaluate <code>true_result</code> if <code>condition</code> is truth-y, and will only evaluate <code>false_result</code> if <code>condition</code> is false-y.</p>

<blockquote><p><strong>Hint:</strong> You can write a one-line if statement with the following syntax: <code>value_when_true</code> if <code>condition</code> else <code>value_when_false</code></p>

<p><strong>Hint:</strong> Using f-Strings might make this problem easier too!</p></blockquote>


            
            <b>Your Answer</b>
            
            <div class="monaco-storable" id="if-macro-python-input" style="height:288px;"></div>
            <a href="index.html#" data-toggle="modal" data-target="#modal-if-macro-python-input">Run in 61A Code</a>
            <div class="modal fade" id="modal-if-macro-python-input" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content" style="padding-bottom: -5px">
                    <iframe
                        id="code-iframe-if-macro-python-input"
                        width="100%"
                        height="700px"
                        style="border: none; display:block;"
                    ></iframe>
                    </div>
                </div>
            </div>
            <div class="storable-status"></div>
            <script>
                $(() => activateEditor('def if_macro(condition, true_result, false_result):\n    &quot;&quot;&quot;\n    &gt;&gt;&gt; eval(if_macro(&quot;True&quot;, &quot;3&quot;, &quot;4&quot;))\n    3\n    &gt;&gt;&gt; eval(if_macro(&quot;0&quot;, &quot;&#x27;if true&#x27;&quot;, &quot;&#x27;if false&#x27;&quot;))\n    &#x27;if false&#x27;\n    &gt;&gt;&gt; eval(if_macro(&quot;1&quot;, &quot;print(&#x27;true&#x27;)&quot;, &quot;print(&#x27;false&#x27;)&quot;))\n    true\n    &gt;&gt;&gt; eval(if_macro(&quot;print(&#x27;condition&#x27;)&quot;, &quot;print(&#x27;true_result&#x27;)&quot;, &quot;print(&#x27;false_result&#x27;)&quot;))\n    condition\n    false_result\n    &quot;&quot;&quot;\n    "*** YOUR CODE HERE ***"\n\n', "scheme", "if-macro-python-input"));
            </script>
        
            <div class="sol-highlight">
                <b>Solution</b>
                
<pre><code>def if_macro(condition, true_result, false_result):
    &quot;&quot;&quot;
    &gt;&gt;&gt; eval(if_macro(&quot;True&quot;, &quot;3&quot;, &quot;4&quot;))
    3
    &gt;&gt;&gt; eval(if_macro(&quot;0&quot;, &quot;&#x27;if true&#x27;&quot;, &quot;&#x27;if false&#x27;&quot;))
    &#x27;if false&#x27;
    &gt;&gt;&gt; eval(if_macro(&quot;1&quot;, &quot;print(&#x27;true&#x27;)&quot;, &quot;print(&#x27;false&#x27;)&quot;))
    true
    &gt;&gt;&gt; eval(if_macro(&quot;print(&#x27;condition&#x27;)&quot;, &quot;print(&#x27;true_result&#x27;)&quot;, &quot;print(&#x27;false_result&#x27;)&quot;))
    condition
    false_result
    &quot;&quot;&quot;
<div class="sol-highlight">    return f&quot;{true_result} if {condition} else {false_result}&quot;</div></code></pre>

            </div>
        


<h1 id="quasiquoting">Quasiquoting</h1>


<pre><code class="scheme">scm&gt; (define a 1)
a
scm&gt; &#x27;(cons a nil)
(cons a nil)</code></pre>



<p>Recall that the <code>quote</code> special form prevents the Scheme interpreter
from executing a following expression. We saw that this helps us create complex
lists more easily than repeatedly calling <code>cons</code> or trying to get the
structure right with <code>list</code>. It seems like this form would come in handy
if we are trying to construct complex Scheme expressions with many nested
lists.</p>

<p>Consider that we rewrite the <code>twice</code> macro as follows:</p>

<pre><code class="scheme">(define&#x2d;macro (twice f)
  &#x27;(begin f f))</code></pre>



<p>This seems like it would have the same effect, but since the <code>quote</code>
form prevents any evaluation, the resulting expression we create would actually
be <code>(begin f f)</code>, which is not what we want.</p>

<p>The <strong>quasiquote</strong> allows us to construct literal lists in a similar way
as quote, but also lets us specify if any sub-expression within the list should be
evaluated.</p>

<p>At first glance, the quasiquote (which can be invoked with the backtick ` or
the <code>quasiquote</code> special form) behaves exactly the same as <code>&#x27;</code> or
<code>quote</code>.  However, using quasiquotes gives you the ability to
<code>unquote</code> (which can be invoked with the comma <code>,</code> or the
<code>unquote</code> special form). This removes an expression from the quoted
context, evaluates it, and places it back in.</p>

<pre><code class="scheme">scm&gt; `(cons a nil)
(cons a nil)
scm&gt; `(cons ,a nil)
(cons 1 nil)</code></pre>



<p>By combining quasiquotes and unquoting, we can often save ourselves a lot
of trouble when building macro expressions.
<!--
Here is how we could use quasiquoting to rewrite our previous example:

<pre><code class="scheme">(define&#x2d;macro (twice f)
  `(begin ,f ,f))</code></pre>


--></p>


<h2 id="questions-2">Questions</h2>

<h3 class="question" id="q6">Q6: Writing Quasiquote Expressions</h3>

<p>Given that the following code has been executed in your Scheme environment:</p>

<pre><code class="scheme">scm&gt; (define a +)
a
scm&gt; (define b 1)
b
scm&gt; (define c 2)
c</code></pre>



<p>Write out the expressions <strong>using quasiquote, unquote, a, b, c, and parentheses</strong> to fill in the blanks that would lead to each of the following being displayed:</p>

<p>For example,</p>

<pre><code class="scheme">scm&gt; ___________
(a b c)</code></pre>



<p><strong>Answer:</strong></p>

<pre><code class="scheme">`(a b c)</code></pre>



<p>a) Fill in the following blank:</p>

<pre><code class="scheme">scm&gt; __________________
(a 1 c)</code></pre>



            <label class="sr-only" for="quasiquote-1-input">Your Answer:</label>
            <input class="form-control storable" id="quasiquote-1-input" type="text">
            <div class="storable-status"></div>
        

<div class="sol-highlight">

<pre><code class="scheme">`(a ,b c)</code></pre>


</div>

<p>b) Fill in the following blank:</p>

<pre><code class="scheme">scm&gt; __________________
3</code></pre>



            <label class="sr-only" for="quasiquote-2-input">Your Answer:</label>
            <input class="form-control storable" id="quasiquote-2-input" type="text">
            <div class="storable-status"></div>
        

<div class="sol-highlight">

<pre><code class="scheme">(a b c)</code></pre>


</div>

<p>c) Fill in the following blank:</p>

<pre><code class="scheme">scm&gt; __________________
(a (b 1) c)</code></pre>



            <label class="sr-only" for="quasiquote-3-input">Your Answer:</label>
            <input class="form-control storable" id="quasiquote-3-input" type="text">
            <div class="storable-status"></div>
        

<div class="sol-highlight">

<pre><code class="scheme">`(a (b ,b) c)</code></pre>


</div>

<p>d) Fill in the following blank:</p>

<pre><code class="scheme">scm&gt; __________________
(a 3 c)</code></pre>



            <label class="sr-only" for="quasiquote-4-input">Your Answer:</label>
            <input class="form-control storable" id="quasiquote-4-input" type="text">
            <div class="storable-status"></div>
        

<div class="sol-highlight">

<pre><code class="scheme">`(a ,(a b c) c)</code></pre>


</div>

<p><strong>Additional Practice</strong>
Now, let the following be defined:</p>

<pre><code class="scheme">scm&gt; (define condition &#x27;(= 1 1))
condition
scm&gt; (define if&#x2d;true &#x27;(print 3))
if&#x2d;true
scm&gt; (define if&#x2d;false &#x27;(print 5))
if&#x2d;false</code></pre>



<p>Write the Scheme expression <strong>using the variables condition, if-true, and if-false</strong> along with quasiquoting, that would evaluate to the following:</p>

<pre><code class="scheme">scm&gt; ________________________
(if (= 1 1) (print 3) (print 5))</code></pre>




            <label class="sr-only" for="quasiquote-5-input">Your Answer:</label>
            <input class="form-control storable" id="quasiquote-5-input" type="text">
            <div class="storable-status"></div>
        

<div class="sol-highlight">

<pre><code class="scheme">`(if ,condition ,if&#x2d;true ,if&#x2d;false)</code></pre>


</div>
<h3 class="question" id="q7">Q7: (Tutorial) If Macro Scheme</h3>

<p>Now let's try to write out the if macro in Scheme! There are quite a few similarities between Python and Scheme, but we do have to make a few adjustments when converting our code over to Scheme. We'll start out by writing a Scheme function using the <code>define</code> form we use for normal functions.</p>

<p>Discuss the following questions with your tutorial group regarding how we can write out a Scheme if-function similar to our Python one:</p>

<p>In the Python If macro, we returned a <strong>string</strong> that, when evaluated, would execute an if statement with the correct parameters. In Scheme, we won't return a string, but rather we'll return something else that represents an unevaluated expression. What type wil we return for Scheme? Here, what "type" refers to what data type -- i.e. function, list, integer, string, etc..</p>


            <label class="sr-only" for="if-macro-disc-1-input">Your Answer:</label>
            <input class="form-control storable" id="if-macro-disc-1-input" type="text">
            <div class="storable-status"></div>
        

<div class="sol-highlight">
Scheme lists
</div>

<p>In the Python If macro, our parameters were all <strong>strings</strong> representing the condition, return value if true, and return value if false. What type will each of our parameters be in Scheme? Give an example of an acceptable parameter for the condition.</p>


            <label class="sr-only" for="if-macro-disc-2-input">Your Answer:</label>
            <input class="form-control storable" id="if-macro-disc-2-input" type="text">
            <div class="storable-status"></div>
        
<div class="sol-highlight">
Strings, or the quoted versions of each of our operands. I.e. for condition, we can pass in <code>&#x27;(= 1 1)</code>
</div>

<p>Let's start writing this out!</p>

<p>Write a function <code>if&#x2d;function</code> using the <code>define</code> form (not the <code>define&#x2d;macro</code> form), which will take in the following parameters:</p>

<ol>
  <li><code>condition</code> : a quoted expression which will evaluate to the condition in our if expression</li>
  <li><code>if&#x2d;true</code> : a quoted expression which will evaluate to the value we want to return if true</li>
  <li><code>if&#x2d;false</code> : a quoted expression which will evaluate to the value we want to return if false</li>
</ol>

<p>and returns a Scheme list representing the expression that, when evaluated, will evaluate to the result of our if expression.</p>

<p>Here are some doctests to show this:</p>

<pre><code class="scheme">scm&gt; (if&#x2d;function &#x27;(= 0 0) &#x27;2 &#x27;3)
(if (= 0 0) 2 3)
scm&gt; (eval (if&#x2d;function &#x27;(= 0 0) &#x27;2 &#x27;3))
2
scm&gt; (if&#x2d;function &#x27;(= 1 0) &#x27;(print 3) &#x27;(print 5))
(if (= 1 0) (print 3) (print 5))
scm&gt; (eval (if&#x2d;function &#x27;(= 1 0) &#x27;(print 3) &#x27;(print 5)))
5</code></pre>



            
            <b>Your Answer</b>
            
            <div class="monaco-storable" id="if-function-scheme-input" style="height:90px;"></div>
            <a href="index.html#" data-toggle="modal" data-target="#modal-if-function-scheme-input">Run in 61A Code</a>
            <div class="modal fade" id="modal-if-function-scheme-input" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content" style="padding-bottom: -5px">
                    <iframe
                        id="code-iframe-if-function-scheme-input"
                        width="100%"
                        height="700px"
                        style="border: none; display:block;"
                    ></iframe>
                    </div>
                </div>
            </div>
            <div class="storable-status"></div>
            <script>
                $(() => activateEditor("(define (if&#x2d;function condition if&#x2d;true if&#x2d;false)\n  'YOUR-CODE-HERE\n)\n", "scheme", "if-function-scheme-input"));
            </script>
        
            <div class="sol-highlight">
                <b>Solution</b>
                
<pre><code>(define (if&#x2d;function condition if&#x2d;true if&#x2d;false)
<div class="sol-highlight">  `(if ,condition ,if&#x2d;true ,if&#x2d;false)</div>)</code></pre>

            </div>
        

<p>That felt a bit overly complicated just to create a function that emulates the if special form. We had to quote parameters, and we had to do an extra call to <code>eval</code> at the end to actually get our answer. To make things easier, we can use the <code>define&#x2d;macro</code> special form to simplify this process.</p>

<p>As a reminder, the <code>define&#x2d;macro</code> form changes the order of evaluation to be:</p>

<ol>
  <li>Evaluate operator</li>
  <li>Apply operator to unevaluated operands</li>
  <li>Evaluate the expression returned by the macro in the frame it was called in.</li>
</ol>

<p>As a comparison, here are differences between <code>define&#x2d;macro</code> and <code>define</code>:</p>

<ol>
  <li>The operands are <strong>not</strong> evaluated immediately. Instead, we can think of the operands as being quoted, similar to what we did in the previous part.</li>
  <li>The return value gets <code>eval</code>ed at the very end, after the entire return expression is constructed. This means that we no longer have to call <code>eval</code> on the return value of our <code>if&#x2d;function</code>.</li>
</ol>

<p>Now, use the <code>define&#x2d;macro</code> special form to define a macro, <code>if&#x2d;macro</code>, that will have functionality shown by the following doctests (notice how the operands are no longer quoted, and that the final <code>eval</code> is gone):</p>

<pre><code class="scheme">scm&gt; (if&#x2d;macro (= 0 0) 2 3)
2
scm&gt; (if&#x2d;macro (= 1 0) (print 3) (print 5))
5</code></pre>




            
            <b>Your Answer</b>
            
            <div class="monaco-storable" id="if-macro-input" style="height:90px;"></div>
            <a href="index.html#" data-toggle="modal" data-target="#modal-if-macro-input">Run in 61A Code</a>
            <div class="modal fade" id="modal-if-macro-input" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content" style="padding-bottom: -5px">
                    <iframe
                        id="code-iframe-if-macro-input"
                        width="100%"
                        height="700px"
                        style="border: none; display:block;"
                    ></iframe>
                    </div>
                </div>
            </div>
            <div class="storable-status"></div>
            <script>
                $(() => activateEditor("(define&#x2d;macro (if&#x2d;macro condition if&#x2d;true if&#x2d;false)\n  'YOUR-CODE-HERE\n)\n", "scheme", "if-macro-input"));
            </script>
        
            <div class="sol-highlight">
                <b>Solution</b>
                
<pre><code>(define&#x2d;macro (if&#x2d;macro condition if&#x2d;true if&#x2d;false)
<div class="sol-highlight">  `(if ,condition ,if&#x2d;true ,if&#x2d;false)</div>)</code></pre>

            </div>
        

  </div>

  <div class='col-md-3 sticky'>
    <nav class='hidden-print hidden-sm hidden-xs sidebar'>
      <ul>
  <li><a href="index.html#discussion-12-vitamin">Discussion 12 Vitamin</a></li>
  <li><a href="index.html#tail-recursion">Tail Recursion</a></li>
  <ul>
    <li><a href="index.html#tail-call-optimization">Tail Call Optimization</a></li>
    <li><a href="index.html#tail-context">Tail Context</a></li>
    <li><a href="index.html#questions">Questions</a></li>
    <ul>
      <li><a href="index.html#q1">Q1: Is Tail Call</a></li>
      <li><a href="index.html#q2">Q2: Sum</a></li>
      <li><a href="index.html#q3">Q3: (Tutorial) Reverse</a></li>
    </ul>
  </ul>
  <li><a href="index.html#python-macros">Python "Macros"</a></li>
  <ul>
    <li><a href="index.html#q4">Q4: Make Lambda Python</a></li>
    <li><a href="index.html#q5">Q5: (Tutorial) If Macro Python</a></li>
  </ul>
  <li><a href="index.html#quasiquoting">Quasiquoting</a></li>
  <ul>
    <li><a href="index.html#questions-2">Questions</a></li>
    <ul>
      <li><a href="index.html#q6">Q6: Writing Quasiquote Expressions</a></li>
      <li><a href="index.html#q7">Q7: (Tutorial) If Macro Scheme</a></li>
    </ul>
  </ul>
</ul>
    </nav>
  </div>
</div>

    </main>

    <footer class="container">
      <div class="row text-center">
        <div class="col col-sm-4">
          <h3><a href="../../index.html">CS 61A</a></h3>
          <ul class="nav nav-pills nav-stacked">
            <li><a href="../../weekly/index.html">Weekly Schedule</a></li>
            <li><a href="../../office-hours/index.html">Office Hours</a></li>
            <li><a href="../../staff/index.html">Staff</a></li>
          </ul>
        </div>
        <div class="col col-sm-4">
          <h3><a href="../../resources/index.html">Resources</a></h3>
          <ul class="nav nav-pills nav-stacked">
            <li><a href="../../articles/studying/index.html">Studying Guide</a></li>
            <li><a href="../../articles/debugging/index.html">Debugging Guide</a></li>
            <li><a href="../../articles/composition/index.html">Composition Guide</a></li>
            <li><a href="../../articles/pair-programming/index.html">Pair Programming</a></li>
          </ul>
        </div>
        <div class="col col-sm-4">
          <h3><a href="../../articles/about/index.html">Policies</a></h3>
          <ul class="nav nav-pills nav-stacked">
            <li><a href="../../articles/about/index.html#assignments">Assignments</a></li>
            <li><a href="../../articles/about/index.html#exams">Exams</a></li>
            <li><a href="../../articles/about/index.html#grading">Grading</a></li>
          </ul>
        </div>
      </div>
    </footer>

    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs/loader.min.js"></script>
  <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs/editor/editor.main.min.css">
  <script>
      require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs' }});
      window.MonacoEnvironment = { getWorkerUrl: () => URL.createObjectURL(new Blob([`
      self.MonacoEnvironment = {
          baseUrl: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min'
      };
      importScripts('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs/base/worker/workerMain.min.js');
  `], { type: 'text/javascript' }))
  };
  </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.15.5/js/jsplumb.min.js"></script>
    <script src="../../assets/js/network_storage.js"></script>
    <script src="../../assets/js/storable.js"></script>
    <script src="../../assets/js/editor.js"></script>
    <script src="../../assets/js/env-diagram.js"></script>
    
<script src="../../assets/js/sketchy.js"></script>
<script>
  $('.sidebar ul').addClass('nav nav-stacked noselect');
  $('body').scrollspy({
    target: '.sidebar',
    offset: 40
  });

  function goToId(id) {
    var target = $(id);
    target.parent().show();
    $('html,body').animate({
      scrollTop: target.offset().top,
    }, 100);
    $("body").scrollspy('refresh');
  }

  if (location.hash) {
    setTimeout(function() {
      if (location.hash) {
        goToId(location.hash);
      }
    }, 1);
  }

  $("a").click(function(event) {
    var urlBeforeHashRegEx = new RegExp("^"+window.location.href.split("#")[0]);
    if (/^#/.test(this.hash) && urlBeforeHashRegEx.test(this.href)) {
      event.preventDefault();
      goToId(this.hash);
      document.location.hash = this.hash;
    }
  });
</script>

  </body>
</html>